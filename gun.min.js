"use strict";!function(){function f(e,t){return t?require(e):e.slice?f[o(e)]:function(t,n){e(t={exports:{}}),f[o(n)]=t.exports};function o(t){return t.split("/").slice(-1).toString().replace(".js","")}}var n;"undefined"!=typeof module&&(n=module),f(function(t){var i,r,a,s,o=Object.prototype.hasOwnProperty;t.exports={random:function(t,n){var e="";for(t=t||24,n=n||"0123456789ABCDEFGHIJKLMNOPQRSTUVWXZabcdefghijklmnopqrstuvwxyz";0<t--;)e+=n.charAt(Math.floor(Math.random()*n.length));return e},match:function(t,n){var e,o;return"string"==typeof t&&(t===((n=(n="string"==typeof n?{"=":n}:n)||{})["="]||n["*"]||n[">"]||n["<"])||o===n["="]&&(e=n["*"]||n[">"],t.slice(0,(e||"").length)===e||o===n["*"]&&(o!==n[">"]&&o!==n["<"]?t>=n[">"]&&t<=n["<"]:o!==n[">"]&&t>=n[">"]||o!==n["<"]&&t<=n["<"])))},hash:function(t,n){if("string"==typeof t){if(n=n||0,!t.length)return n;for(var e=0,o=t.length;e<o;++e)n=(n<<5)-n+t.charCodeAt(e),n|=0;return n}},plain:function(t){return!!t&&(t instanceof Object&&t.constructor===Object||"Object"===Object.prototype.toString.call(t).match(/^\[object (\w+)\]$/)[1])},empty:function(t,n){for(var e in t)if(o.call(t,e)&&(!n||-1==n.indexOf(e)))return!1;return!0},parseAsync:function(t,n,e){try{n(void 0,JSON.parse(t,e))}catch(t){n(t)}},stringifyAsync:function(t,n,e,o){try{n(void 0,JSON.stringify(t,e,o))}catch(t){n(t)}}},Object.keys||(Object.keys=(i=Object.prototype.hasOwnProperty,r=!{toString:null}.propertyIsEnumerable("toString"),s=(a=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"]).length,function(t){if("function"!=typeof t&&("object"!=typeof t||null===t))throw new TypeError("Object.keys called on non-object");var n,e,o=[];for(n in t)i.call(t,n)&&o.push(n);if(r)for(e=0;e<s;e++)i.call(t,a[e])&&o.push(a[e]);return o}));var n,e,u,c,f,l,p,h,d,g,_=(_=setTimeout,e=n=0,u=typeof setImmediate!=""+void 0&&setImmediate||_,function(t){+new Date-n<=1&&e++<3333?t():u(function(){n=+new Date,t()},e=0)}),_=(l=(f=t.exports.setTimeoutTurn=function(t){1==l.push(t)&&p(d)}).s=[],p=_,h=0,d=function(){(c=l[h++])&&c(),h!=l.length&&99!=h||(l=f.s=l.slice(h),h=0),l.length&&p(d)},f);g=_,(t.exports.setTimeoutEach=function(r,a,s,u){u=u||9,function t(n,e,o){if(e=(n=(r||[]).splice(0,u)).length){for(var i=0;i<e&&void 0===(o=a(n[i]));i++);if(void 0===o)return void g(t)}s&&s(o)}()})()})(f,"./utils"),f(function(t){t.exports=function t(n,e,o){if(!n)return{to:t};var i="function"==typeof e,n=(this.tag||(this.tag={}))[n]||i&&(this.tag[n]={tag:n,to:t._={next:function(t){var n;(n=this.to)&&n.next(t)}}});if(i){o={off:t.off||(t.off=function(){if(this.next===t._.next)return!0;this===this.the.last&&(this.the.last=this.back),this.to.back=this.back,this.next=t._.next,this.back.to=this.to,this.the.last===this.the&&delete this.on.tag[this.the.tag]}),to:t._,next:e,the:n,on:this,as:o};return(o.back=n.last||n).to=o,n.last=o}return(n=n.to)&&void 0!==e&&n.next(e),n}})(f,"./onto"),f(function(t){t.exports=function(t){return null===t||"string"==typeof t||"boolean"==typeof t||"number"==typeof t&&t!=1/0&&t!=-1/0&&t==t||!!t&&"string"==typeof t["#"]&&1===Object.keys(t).length&&t["#"]}})(f,"./valid"),f(function(t){function n(){var t=+new Date;return i=i<t?(e=0,t+n.drift):t+(e+=1)/o+n.drift}f("./utils");n.drift=0;var e=0,o=999,i=-1/0;n.is=function(t,n,e){e=n&&t&&t._&&t._[">"]||e;if(e)return"number"==typeof(e=e[n])?e:-1/0},n.ify=function(t,n,e,o,i){(t=t||{})._=t._||{},i&&(t._["#"]=i);i=t._[">"]||(t._[">"]={});return void 0!==n&&"_"!==n&&("number"==typeof e&&(i[n]=e),void 0!==o&&(t[n]=o)),t},t.exports=n})(f,"./state"),f(function(t){f("./utils"),t.exports=function(o){var i={s:{}},r=i.s;o=o||{max:999,age:9e3},i.check=function(t){return!!r[t]&&n(t)};var n=i.track=function(t){t=r[t]||(r[t]={});return t.was=i.now=+new Date,i.to||(i.to=setTimeout(i.drop,o.age+9)),t};return i.drop=function(e){i.to=null,i.now=+new Date;var t=Object.keys(r);console.STAT&&console.STAT(i.now,+new Date-i.now,"dup drop keys"),Gun.__utils__.setTimeoutEach(t,function(t){var n=r[t];n&&(e||o.age)>i.now-n.was||delete r[t]},0,99)},i}})(f,"./dup"),f(function(t){f("./onto");var a=f("./utils");t.exports=function(t,n){if(this.on){var e=(this.opt||{}).lack||9e3;if("function"!=typeof t){if(!t)return;var o=t["#"]||t,i=(this.tag||"")[o];return i?(n&&(i=this.on(o,n),clearTimeout(i.err),i.err=setTimeout(function(){i.off()},e)),!0):void 0}o=n&&n["#"]||a.random(9);if(!t)return o;var r=this.on(o,t,n);return r.err=r.err||setTimeout(function(){r.off(),r.next({err:"Error: No ACK yet.",lack:!0})},e),o}}})(f,"./ask"),f(function(t){function g(t){return t instanceof g?(this._={$:this}).$:this instanceof g?g.create(this._={$:this,opt:t}):new g(t)}function a(t,a){var s=+new Date,n=t._||{},u=n.DBG=t.DBG,c=t["#"],f=_(9),l=Object.keys(a||"").sort(),p=((a||"")._||"")["#"],h=(l.length,t.$._.root),d=a===h.graph[p];console.STAT&&console.STAT(s,((u||n).gk=+new Date)-s,"got keys"),a&&function t(){s=+new Date;for(var n,e,o,i=0,r={};i<9&&(n=l[i++]);)v(r,n,A(a,n),a[n],p);l=l.slice(i),(e={})[p]=r,r=e,d&&((o=function(){}).ram=o.faith=!0),e=l.length,console.STAT&&console.STAT(s,-(s-(s=+new Date)),"got copied some"),u&&(u.ga=+new Date),h.on("in",{"@":c,"#":f,put:r,"%":e?f=_(9):S,$:h.$,_:o,DBG:u}),console.STAT&&console.STAT(s,+new Date-s,"got in"),e&&g.__utils__.setTimeoutTurn(t)}(),a||h.on("in",{"@":t["#"]})}g.is=function(t){return t instanceof g||t&&t._&&t===t._.$||!1},g.version=.202,(g.chain=g.prototype).toJSON=function(){},g.__utils__=f("./utils"),g.valid=f("./valid"),g.state=f("./state"),g.on=f("./onto"),g.dup=f("./dup"),g.ask=f("./ask"),function(){function m(t){if(t)if(t.out!==m){var n,e=this.as,o=e.at||e,i=o.$,r=o.dup,a=t.DBG;if((e=t["#"])||(e=t["#"]=_(9)),!r.check(e)){if(r.track(e),e=t._,t._="function"==typeof e?e:function(){},t.$&&t.$===(t.$._||"").$||(t.$=i),t["@"]&&!t.put&&(e=(r=t)["@"]||"",(n=e._)&&(n.acks=(n.acks||0)+1,(n.err=r.err)&&(r["@"]=n["#"],b(n)),n.stop||n.crack||(n.crack=n.match&&n.match.push(function(){u(n)})),u(n))),!o.ask(t["@"],t)){if(a&&(a.u=+new Date),t.put)return void s(t);t.get&&g.on.get(t,i)}a&&(a.uc=+new Date),this.to.next(t),a&&(a.ua=+new Date),t.nts||t.NTS||(t.out=m,o.on("out",t),a&&(a.ue=+new Date))}}else this.to.next(t)}function s(a){if(a){var s=a._||"",t=s.root=((s.$=a.$||"")._||"").root;if(a["@"]&&s.faith&&!s.miss)return a.out=m,void t.on("out",a);s.latch=t.hatch,s.match=t.hatch=[];var u,c,f,l,p,h,d,g,_,v=a.put,y=s.DBG=a.DBG,k=+new Date;v["#"]&&v["."]||(y&&(y.p=k),s["#"]=a["#"],s.msg=a,s.all=0,s.stun=1,u=Object.keys(v),console.STAT&&console.STAT(k,((y||s).pk=+new Date)-k,"put sort"),c=0,function t(n){if(f!=c){if(!(p=u[f=c]))return console.STAT&&console.STAT(k,((y||s).pd=+new Date)-k,"put"),void b(s);(h=v[p])?(_=h._)?p!==_["#"]?g=w+$(p)+"soul not same.":(d=_[">"])||(g=w+$(p)+"no state."):g=w+$(p)+"no meta.":g=w+$(p)+"no node.",l=Object.keys(h||{})}if(g)return a.err=s.err=g,void b(s);var e,o=0;for(n=n||0;n++<9&&(e=l[o++]);)if("_"!==e){var i=h[e],r=d[e];if(S===r){g=w+$(e)+"on"+$(p)+"no state.";break}if(!O(i)){g=w+$(e)+"on"+$(p)+"bad "+typeof i+$(i);break}!function t(n,e,o,i,r){var a=r._||"",s=a.root,u=s.graph;var c=u[o]||G,f=A(c,e,1),l=c[e];var p=a.DBG;(c=console.STAT)&&(u[o]&&l||(c.has=(c.has||0)+1));u=j();if(u<i)return setTimeout(function(){t(n,e,o,i,r)},(c=i-u)>x?x:c),void(console.STAT&&console.STAT((p||a).Hf=+new Date,c,"future"));if(i<f&&!a.miss)return;if(!a.faith&&i===f&&(n===l||T(n)<=T(l))&&!a.miss)return;a.stun++;var h=r["#"]+a.all++,l={toString:function(){return h},_:a};l.toJSON=l.toString;p&&(p.ph=p.ph||+new Date);s.on("put",{"#":l,"@":r["@"],put:{"#":o,".":e,":":n,">":i},_:a})}(i,e,p,r,a)}(l=l.slice(o)).length?D(t):(++c,l=null,t(n))}())}}function e(t){(u=(t._||"").DBG)&&(u.pa=+new Date,u.pm=u.pm||+new Date);var n=this.as,e=n.graph,o=t._,i=t.put,r=i["#"],a=i["."],s=i[":"],u=i[">"];t["#"];(i=o.msg)&&(i=i.put)&&(i=i[r])&&v(i,a,u,s,r),e[r]=v(e[r],a,u,s,r),(i=(n.next||"")[r])&&i.on("in",t),b(o),this.to.next(t)}function b(t,n){var e,o;t.stop||!t.err&&0<--t.stun||(t.stop=1,(e=t.root)&&((o=t.match).end=1,o===e.hatch&&(!(o=t.latch)||o.end?delete e.hatch:e.hatch=o),t.hatch&&t.hatch(),g.__utils__.setTimeoutEach(t.match,function(t){t&&t()}),!(n=t.msg)||t.err||n.err||(n.out=m,t.root.on("out",n))))}function u(t){t&&t.root&&(t.stun||t.acks!==t.all||t.root.on("in",{"@":t["#"],err:t.err,ok:t.err?S:{"":1}}))}g.create=function(t){t.root=t.root||t,t.graph=t.graph||{},t.on=t.on||g.on,t.ask=t.ask||g.ask,t.dup=t.dup||g.dup();var n=t.$.opt(t.opt);return t.once||(t.on("in",m,t),t.on("out",m,t),t.on("put",e,t),g.on("create",t),t.on("create",t)),t.once=1,n},g.on.put=s;var w="Error: Invalid graph!",$=function(t){return" '"+(""+t).slice(0,9)+"...' "},T=JSON.stringify,x=2147483647,j=g.state}(),g.on.get=function(t,n){var e=n._,o=t.get,i=o["#"],r=e.graph[i],n=o["."],o=((e.next||(e.next={}))[i],(t._||{}).DBG=t.DBG);if(o&&(o.g=+new Date),!r)return e.on("get",t);if(n){if("string"!=typeof n||S===r[n])return e.on("get",t);r=v({},n,A(r,n),r[n],i)}r&&a(t,r),e.on("get",t)},g.on.get.ack=a,g.chain.opt=function(t){var e=this._,n=(t=t||{}).peers||t;return g.__utils__.plain(t)||(t={}),g.__utils__.plain(e.opt)||(e.opt=t),(n="string"==typeof n?[n]:n)instanceof Array&&(g.__utils__.plain(e.opt.peers)||(e.opt.peers={}),n.forEach(function(t){var n={};n.id=n.url=t,e.opt.peers[t]=e.opt.peers[t]||n})),e.opt.peers=e.opt.peers||{},o(t,function t(n){var e=this[n];this&&this.hasOwnProperty(n)||"string"==typeof e||g.__utils__.empty(e)?this[n]=e:(!e||e.constructor===Object||e instanceof Array)&&o(e,t)}),g.on("opt",e),e.opt.uuid=e.opt.uuid||function(t){return g.state().toString(36).replace(".","")+g.__utils__.random(t||12)},this};var S,e,o=function(t,n){Object.keys(t).forEach(n,t)},_=g.__utils__.random,D=g.__utils__.setTimeoutTurn,O=g.valid,A=g.state.is,v=g.state.ify,G={};(g.log=function(){return g.log.off||e.log.apply(e,arguments),[].slice.call(arguments).join(" ")}).once=function(t,n,e){return(e=g.log.once)[t]=e[t]||0,e[t]++||g.log(n)},"undefined"!=typeof window&&((window.GUN=window.Gun=g).window=window);try{void 0!==n&&(n.exports=g)}catch(t){}((t.exports=g).window||{}).console=(g.window||{}).console||{log:function(){}},e=console,g.log.only=function(t,n){return g.log.only.i&&t===g.log.only.i&&g.log.only.i++&&(e.log.apply(e,arguments)||n)},g.log.once("welcome","Hello wonderful person! :) Thanks for using GUN, please ask for help on http://chat.gun.eco if anything takes you longer than 5min to figure out!")})(f,"./root"),f(function(t){f("./root").chain.back=function(t,n){if(-1===(t=t||1)||1/0===t)return this._.root.$;if(1===t)return(this._.back||this._).$;var e=this._;if((t="string"==typeof t?t.split("."):t)instanceof Array){for(var o=0,i=t.length,r=e;o<i;o++)r=(r||s)[t[o]];return void 0!==r?n?this:r:(r=e.back)?r.$.back(t,n):void 0}if("function"!=typeof t)return"number"==typeof t?(e.back||e).$.back(t-1):this;for(var a,r={back:e};(r=r.back)&&void 0===(a=t(r,n)););return a};var s={}})(f,"./back"),f(function(t){var l=f("./root");function p(t,n){if(n=n||this.as||t.$._,(!t.$$||this===l.on)&&t.put&&!n.soul){var e=t.put||"",o=e["="]||e[":"],t=n.root,e=t.$.get(e["#"]).get(e["."])._;if("string"==typeof(o=_(o))){if(!(e.echo||(e.echo={}))[n.id]||(t.pass||"")[n.id]){if(i=t.pass){if(i[o+n.id])return;i[o+n.id]=1}((e.echo||(e.echo={}))[n.id]=n).has&&(n.link=o);var i,t=t.$.get(e.link=o)._;(t.echo||(t.echo={}))[e.id]=e,((i=n.ask||"")[""]||n.lex)&&t.on("out",{get:{"#":o}}),l.__utils__.setTimeoutEach(Object.keys(i),function(t,n){t&&(n=i[t])&&n.on("out",{get:{"#":o,".":t}})},0,99)}}else this===l.on&&((e.echo||(e.echo={}))[n.id]=n)}}function h(t,e){var o,n,i=t.put||"",i=d!==i["="]?i["="]:i[":"],r=e.root;if(d===i)return e.soul&&d!==e.put?void 0:(n=(t.$$||t.$||"")._||"",!t["@"]||d===n.put&&d===e.put?((o=e.link||t.linked)&&delete(r.$.get(o)._.echo||"")[e.id],e.has&&(e.link=null),e.put=d,void l.__utils__.setTimeoutEach(Object.keys(e.next||""),function(t,n){(n=e.next[t])&&(o&&delete(r.$.get(o).get(t)._.echo||"")[n.id],n.on("in",{get:t,put:d,$:n.$}))},0,99)):void 0);e.soul||t.$$||(o=_(i),n=t.$._||"",(o!==n.link&&(!e.has||n.link)||(r.pass||"")[e.id]&&"string"!=typeof o)&&(delete(n.echo||"")[e.id],h({get:e.get,put:d,$:t.$,linked:t.linked=t.linked||n.link},e)))}function a(t,n){var e=this.as,o=e.$._,i=(o.root,e.get||""),e=(t.put||"")[i["#"]]||"";if(!t.put||"string"==typeof i["."]&&d===e[i["."]])return d===o.put&&(o.soul||o.has)?(o.ack=(o.ack||0)+1,void o.on("in",{get:o.get,put:o.put=d,$:o.$,"@":t["@"]})):void 0;(t._||{}).miss=1,l.on.put(t)}l.chain.chain=function(t){var n=this,e=n._,o=new(t||n).constructor(n),t=o._;return t.root=e=e.root,t.id=++e.once,t.back=n._,t.on=l.on,t.on("in",l.on.in,t),t.on("out",l.on.out,t),o},l.on.out=function(t){var n,e,o=this.as,i=o.back,r=o.root;if(t.$||(t.$=o.$),this.to.next(t),!o.err){if(n=t.get){if(r.pass&&(r.pass[o.id]=o),o.lex&&Object.keys(o.lex).forEach(function(t){e[t]=o.lex[t]},e=t.get=t.get||{}),n["#"]||o.soul){if(n["#"]=n["#"]||o.soul,t["#"]||(t["#"]=s(9)),i=r.$.get(n["#"])._,n=n["."]){if(u(i.put,n)&&(e=i.ask&&i.ask[n],(i.ask||(i.ask={}))[n]=i.$.get(n)._,i.on("in",{get:n,put:{"#":i.soul,".":n,":":i.put[n],">":v(r.graph[i.soul],n)}}),e))return}else{if(e=i.ask&&i.ask[""],(i.ask||(i.ask={}))[""]=i,d!==i.put&&(i.on("in",i),e))return;t.$=i.$}return r.ask(a,t),r.on("in",t)}if(n["."])return o.get?(t={get:{".":o.get},$:o.$},(i.ask||(i.ask={}))[o.get]=t.$._):t={get:o.lex?t.get:{},$:o.$},i.on("out",t);if(((o.ask||(o.ask={}))[""]=o).get)return n["."]=o.get,(i.ask||(i.ask={}))[o.get]=t.$._,i.on("out",t)}return i.on("out",t)}o.on("in",{put:o.put=d,$:o.$})},l.on.in=function(n,e){var o,t,i=(e=e||this.as).root,r=((o=n.$||(n.$=e.$))||"")._||g,a=n.put||"",s=a["#"],u=a["."],c=d!==a["="]?a["="]:a[":"],f=a[">"]||-1/0;if(d!==n.put&&(d===a["#"]||d===a["."]||d===a[":"]&&d===a["="]||d===a[">"]))return _(a)?void e.on("in",{$:r.back.$,put:{"#":s=r.back.soul,".":u=r.has||r.get,"=":a,">":v(r.back.put,u)},via:n}):(s=((a||"")._||"")["#"])?(o=e.root.$.get(s),l.__utils__.setTimeoutEach(Object.keys(a).sort(),function(t){"_"!=t&&d!==(f=v(a,t))&&e.on("in",{$:o,put:{"#":s,".":t,"=":a[t],">":f},VIA:n})})):void console.log("chain not yet supported for",a,"...",n,e);(n.seen||"")[e.id]||(((n.seen||(n.seen=function(){}))[e.id]=e)!==r&&(Object.keys(n).forEach(function(t){a[t]=n[t]},a={}),a.get=e.get||a.get,e.soul||e.has?r.soul&&(a.$=e.$,a.$$=a.$$||r.$):a.$$$=a.$$$||e.$,n=a),h(n,e),(e.soul||n.$$)&&f>=v(i.graph[s],u)&&((a=i.$.get(s)._).put=y(a.put,u,f,c,s)),!r.soul&&f>=v(i.graph[s],u)&&(t=(i.$.get(s)._.next||"")[u])&&(t.put=c,"string"==typeof(a=_(c))&&(t.put=i.$.get(a)._.put||c)),this.to&&this.to.next(n),e.any&&l.__utils__.setTimeoutEach(Object.keys(e.any),function(t){(t=e.any[t])&&t(n)},0,99),e.echo&&l.__utils__.setTimeoutEach(Object.keys(e.echo),function(t){(t=e.echo[t])&&t.on("in",n)},0,99),((n.$$||"")._||r).soul&&(t=e.next)&&(t=t[u])&&(a={},Object.keys(n).forEach(function(t){a[t]=n[t]}),a.$=(n.$$||n.$).get(a.get=u),delete a.$$,delete a.$$$,t.on("in",a)),p(n,e))},l.on.link=p,l.on.unlink=h;var d,g={},s=l.__utils__.random,_=l.valid,u=function(t,n){return t&&Object.prototype.hasOwnProperty.call(t,n)},n=l.state,v=n.is,y=n.ify})(f,"./chain"),f(function(t){var g=f("./root");function r(t){var n=this.at||this.on;if(!t||n.soul||n.has)return this.off();if(t=(t=(t=t.$||t)._||t).id){n.map;if((n=this.seen||(this.seen={}))[t])return!0;n[t]=!0}}g.chain.get=function(t,n,e){var o;if("string"==typeof t){if(0==t.length)return(i=this.chain())._.err={err:g.log("0 length key!",t)},n&&n.call(i,i._.err),i;var i=(i=!(i=((f=this._).next||a)[t])?t&&function(t,n){var e=n._,o=e.next,i=n.chain()._;o=o||(e.next={});o[i.get=t]=i,n===e.root.$?i.soul=t:(e.soul||e.has)&&(i.has=t);return i}(t,this):i)&&i.$}else{if("function"==typeof t){if(!0===n)return function(t,n,e){var a,s=t._,u=0;if(a=s.soul||s.link)return n(a,e,s);if(s.jam)return s.jam.push([n,e]);s.jam=[[n,e]],t.get(function(t,n){if(!(_===t.put&&!s.root.opt.super&&(a=Object.keys(s.root.opt.peers).length)&&++u<=a)){n.rid(t);var e=(e=t.$)&&e._||{},o=0;for(a=s.jam,delete s.jam;r=a[o++];){var i=r[0],r=r[1];i&&i(e.link||e.soul||g.valid(t.put)||((t.put||{})._||{})["#"],r,t,n)}}},{out:{get:{".":!0}}})}(this,t,e),this;var c,f=(i=this)._,l=n||{},p=f.root;l.at=f,l.ok=t;var h={};function d(n,t,e){if(!d.stun&&(!(o=p.pass)||o[c])){var o,i=n.$._,r=(n.$$||"")._,a=(r||i).put,s=!i.has&&!i.soul,u={};if(!s&&_!==a||(a=_===((o=n.put)||"")["="]?_===(o||"")[":"]?o:o[":"]:o["="]),"string"==typeof(o=g.valid(a))&&(a=_===(o=p.$.get(o)._.put)?l.not?_:a:o),!l.not||_!==a){if(_===l.stun){if((o=p.stun)&&o.on&&(f.$.back(function(t){if(o.on(""+t.id,u={}),(u.run||0)<d.id)return u}),u.run||o.on(""+i.id,u={}),!u.run&&r&&o.on(""+r.id,u={}),d.id>u.run&&(u.stun&&!u.stun.end||(u.stun=o.on("stun"),u.stun=u.stun&&u.stun.last),u.stun&&!u.stun.end)))return void((u.stun.add||(u.stun.add={}))[c]=function(){d(n,t,1)});if(_===a&&(e=0),(o=p.hatch)&&!o.end&&_===l.hatch&&!e)return h[i.$._.id]?void 0:(h[i.$._.id]=1,void o.push(function(){d(n,t,1)}));h={}}if(p.pass){if(p.pass[c+i.id])return;p.pass[c+i.id]=1}l.on?l.ok.call(i.$,a,i.get,n,t||d):l.v2020?l.ok(n,t||d):(Object.keys(n).forEach(function(t){o[t]=n[t]},o={}),(n=o).put=a,l.ok.call(l.as,n,t||d))}}}return(((d.at=f).any||(f.any={}))[c=g.__utils__.random(7)]=d).off=function(){d.stun=1,f.any&&delete f.any[c]},d.rid=r,d.id=l.run||++p.once,o=p.pass,(p.pass={})[c]=1,l.out=l.out||{get:{}},f.on("out",l.out),p.pass=o,i}if("number"==typeof t)return this.get(""+t,n,e);if("string"==typeof(o=s(t)))return this.get(o,n,e);(o=this.get.next)&&(i=o(this,t))}return i?n&&"function"==typeof n&&i.get(n,e):((i=this.chain())._.err={err:g.log("Invalid get request!",t)},n&&n.call(i,i._.err)),i};var _,a={},s=g.valid})(f,"./get"),f(function(t){var v=f("./root");function y(n,t){var e,o,i;t&&(t=(t._||"").id||t,e=n.root.stun||(n.root.stun={on:v.on}),o={},n.stun||(n.stun=e.on("stun",function(){})),(i=e.on(""+t))&&i.the.last.next(o),o.run>=n.run||e.on(""+t,function(t){return n.stun.end?(this.off(),void this.to.next(t)):(t.run=t.run||n.run,void(t.stun=t.stun||n.stun))}))}function k(n){var e,t,o,i,r;n.err?k.end(n.stun,n.root):n.todo.length||n.end||!v.__utils__.empty(n.wait)||(n.end=1,r=n.$.back(-1)._,e=r.root,t=r.ask(function(t){e.on("ack",t),t.err&&v.log(t),++o>(n.acks||0)&&this.off(),n.ack&&n.ack(t,this)},n.opt),o=0,i=n.stun,(r=function(){i&&(k.end(i,e),v.__utils__.setTimeoutEach(Object.keys(i=i.add||""),function(t){(t=i[t])&&t()}))}).hatch=r,n.via._.on("out",{put:n.out=n.graph,opt:n.opt,"#":t,_:r}))}v.chain.put=function(t,n,g){var e=this,o=e._,i=o.root;(g=g||{}).root=o.root,g.run||(g.run=i.once),y(g,o.id),g.ack=g.ack||n,g.via=g.via||e,g.data=g.data||t,g.soul||(g.soul=o.soul||"string"==typeof n&&n);var _=g.state=g.state||v.state();return"function"==typeof t?t(function(t){g.data=t,e.put(void 0,void 0,g)}):g.soul?(g.$=i.$.get(g.soul),g.todo=[{it:g.data,ref:g.$}],g.turn=g.turn||r,g.ran=g.ran||k,function t(){var n,e,i,r,a,o,s,u=g.todo,c=u.pop(),f=c.it;c.ref&&c.ref._.id;if(y(g,c.ref),(r=c.todo)&&(f=f[e=r.pop()],r.length&&u.push(c)),e&&(u.path||(u.path=[])).push(e),!(n=m(f))&&!(a=v.is(f))){if(!v.__utils__.plain(f))return void k.err(g,"Invalid data: "+((o=f)&&(s=o.constructor)&&s.name||typeof o)+" at "+(g.via.back(function(t){t.get&&r.push(t.get)},r=[])||r.join("."))+"."+(u.path||[]).join("."));for(var l=g.seen||(g.seen=[]),p=l.length;p--;)if(f===(r=l[p]).it){n=f=r.link;break}}if(e&&n)c.node=b(c.node,e,_,f);else{if(!g.seen)return void k.err(g,"Data at root of graph must be a node (an object).");g.seen.push(i={it:f,link:{},todo:a?[]:Object.keys(f).sort().reverse(),path:(u.path||[]).slice(),up:c}),c.node=b(c.node,e,_,i.link),!a&&i.todo.length&&u.push(i);var h=g.seen.length;function d(t,n){var e=i.link["#"];n&&(n.off(),n.rid(t));var o=e||t.soul||(r=(t.$$||t.$)._||"").soul||r.link||((r=r.put||"")._||"")["#"]||r["#"]||((r=t.put||"")&&t.$$?r:r["="]||r[":"]||"")["#"];e||y(g,t.$),o||c.link["#"]?(o||(o=[],(t.$$||t.$).back(function(t){return(r=t.soul||t.link)?o.push(r):void o.push(t.get)}),o=o.reverse().join("/")),i.link["#"]=o,a||(((g.graph||(g.graph={}))[o]=i.node||(i.node={_:{}}))._["#"]=o),delete g.wait[h],i.wait&&v.__utils__.setTimeoutEach(i.wait,function(t){t&&t()}),g.ran(g)):(c.wait||(c.wait=[])).push(function(){d(t,n)})}(g.wait||(g.wait={}))[h]="",r=(i.ref=a?f:e?c.ref.get(e):c.ref)._,(r=f&&(f._||"")["#"]||r.soul||r.link)?d({soul:r}):i.ref.get(d,{run:g.run,v2020:1,out:{get:{".":" "}}})}if(!u.length)return g.ran(g);g.turn(t)}()):function(n){var e,t=n.via._;n.via=n.via.back(function(t){return t.soul||!t.get?t.$:(e=n.data,void((n.data={})[t.get]=e))}),n.via&&n.via._.soul||(n.via=t.root.$.get(((n.data||"")._||"")["#"]||t.$.back("opt.uuid")()));n.via.put(n.data,n.ack,n)}(g),e},k.end=function(t,n){t.end=e,t.the.to===t&&t===t.the.last&&delete n.stun,t.off()},k.err=function(t,n){(t.ack||e).call(t,t.out={err:t.err=v.log(n)}),t.ran(t)};var e=function(){},r=v.__utils__.setTimeoutTurn,m=v.valid,b=v.state.ify})(f,"./put"),f(function(t){var n=f("./root");f("./chain"),f("./back"),f("./put"),f("./get"),t.exports=n})(f,"./index"),f(function(t){var g=f("./index");g.chain.on=function(t,n,e,o){var i=this._;i.root;if("string"==typeof t)return n?(o=i.on(t,n,e||i,o),e&&e.$&&(e.subs||(e.subs=[])).push(o),this):i.on(t);(n=!0===n?{change:!0}:n||{}).not=1,n.on=1;return this.get(t,n),this},g.chain.once=function(c,f){if(f=f||{},!c)return t=this,g.log.once("valonce","Chainable val is experimental, its behavior and API may change moving forward. Please play with it and report bugs and ideas on how to improve it."),(e=t.chain())._.nix=t.once(function(t,n){e._.on("in",this._)}),e._.lex=t._.lex,e;var t,e,l,p=this._,h=p.root,d=(p.put,g.__utils__.random(7));return this.get(function(n,e,o,i){var r=this,a=r._,s=a.one||(a.one={});function u(t){a.has||a.soul||(a={put:n,get:e}),void 0===(l=a.put)&&(l=((o.$$||"")._||"").put),"string"!=typeof g.valid(l)||void 0!==(l=h.$.get(l)._.put)||t?i.stun||""!==s[d]&&(s[d]="",(p.soul||p.has)&&i.off(),c.call(r,l,a.get),clearTimeout(s[d])):s[d]=setTimeout(function(){u(1)},f.wait||99)}i.stun||""!==s[d]&&(!0!==(l=g.valid(n))?"string"!=typeof l&&(clearTimeout((p.one||"")[d]),clearTimeout(s[d]),s[d]=setTimeout(u,f.wait||99)):u())},{on:1}),this},g.chain.off=function(){var e,t=this._,o=t.back;if(o)return t.ack=0,(e=o.next)&&e[t.get]&&delete e[t.get],(e=o.ask)&&delete e[t.get],(e=o.put)&&delete e[t.get],(e=t.soul)&&delete o.root.graph[e],(e=t.map)&&Object.keys(e).forEach(function(t,n){(n=e[t]).link&&o.root.$.get(n.link).off()}),(e=t.next)&&Object.keys(e).forEach(function(t,n){e[t].$.off()}),t.on("off",{}),this}})(f,"./on"),f(function(t){var s=f("./index"),o=s.chain.get.next;function u(t){this.to.next(t);var n=this.as,e=t.$._,o=t.put;(e.soul||t.$$)&&((e=n.lex)&&!s.__utils__.match(t.get||(o||"")["."],e["."]||e["#"]||e)||s.on.link(t,n))}s.chain.get.next=function(t,n){var e;return s.__utils__.plain(n)?(e=((e=n["#"])||"")["="]||e)?t.get(e):((e=t.chain()._).lex=n,t.on("in",function(t){s.__utils__.match(t.get||(t.put||"")["."],n["."]||n["#"]||n)&&e.on("in",t),this.to.next(t)}),e.$):(o||c)(t,n)},s.chain.map=function(r,t,n){var e,a,o=this,i=o._;return s.__utils__.plain(r)&&(e=r["."]?r:{".":r},r=void 0),r?(s.log.once("mapfn","Map functions are experimental, their behavior and API may change moving forward. Please play with it and report bugs and ideas on how to improve it."),a=o.chain(),o.map().on(function(t,n,e,o){o=(r||c).call(this,t,n,e,o);if(void 0!==o){if(t===o)return a._.on("in",e);if(s.is(o))return a._.on("in",o._);var i={};Object.keys(e.put).forEach(function(t){i[t]=e.put[t]},i),i["="]=o,a._.on("in",{get:n,put:i})}})):(a=i.each)||((i.each=a=o.chain())._.lex=e||a._.lex||i.lex,a._.nix=o.back("nix"),o.on("in",u,a._)),a};var c=function(){}})(f,"./map"),f(function(t){var s=f("./index");s.chain.set=function(t,i,n){var e,r,a=this,o=a.back(-1);return i=i||function(){},(n=n||{}).item=n.item||t,(e=((t||"")._||"")["#"])&&((t={})["#"]=e),"string"==typeof(r=s.valid(t))?a.get(e=r).put(t,i,n):s.is(t)?(a.put(function(o){t.get(function(t,n,e){return t?((r={})[t]={"#":t},void o(r)):i.call(a,{err:s.log('Only a node can be linked! Not "'+e.put+'"!')})},!0)}),t):(s.__utils__.plain(t)&&(t=o.get(e=a.back("opt.uuid")()).put(t)),a.get(e||o.back("opt.uuid")(7)).put(t,i,n))}})(f,"./set"),f(function(t){var T=f("./utils");function n(u){var g=function(){},_=u.opt||{};_.log=_.log||console.log,_.gap=_.gap||_.wait||0,_.max=_.max||.3*(_.memory?999*_.memory*999:3e8),_.pack=_.pack||.01*_.max*.01,_.puff=_.puff||9;var v=Gun.__utils__.setTimeoutTurn||setTimeout,i=Gun.__utils__.parseAsync,y=Gun.__utils__.stringifyAsync,k=u.dup,m=k.check,b=k.track,s=(new Date,g.hear=function(t,a){if(t){if(_.max<=t.length)return g.say({dam:"!",err:"Message too big!"},a);g===this&&(s.d+=t.length||0,++s.c);var n,e=a.SH=+new Date,o=t[0];if("["===o)return i(t,function(t,i){if(t||!i)return g.say({dam:"!",err:"DAM JSON parse error."},a);console.STAT&&console.STAT(+new Date,i.length,"# on hear batch");var r=_.puff;!function t(){for(var n,e=+new Date,o=0;o<r&&(n=i[o++]);)s(n,a);i=i.slice(o),console.STAT&&console.STAT(e,+new Date-e,"hear loop"),w(a),i.length&&v(t,0)}()}),void(t="");if("{"===o||(t["#"]||T.plain(t))&&(n=t)){if(n)return s.one(n,a,e);i(t,function(t,n){return t||!n?g.say({dam:"!",err:"DAM JSON parse error."},a):void s.one(n,a,e)})}}});s.one=function(t,n,e){var o,i,r,a,s;if(t.DBG&&(t.DBG=s={DBG:t.DBG}),s&&(s.h=e),s&&(s.hp=+new Date),(o=t["#"])||(o=t["#"]=T.random(9)),!((r=m(o))||(i=t["##"])&&(r=t["@"]||t.get&&o)&&k.check(a=r+i))){if((t._=function(){}).via=g.leap=n,(r=t["><"])&&"string"==typeof r&&r.slice(0,99).split(",").forEach(function(t){this[t]=1},t._.yo={}),r=t.dam)return(r=g.hear[r])&&r(t,n,u),void b(o);e=+new Date;s&&(s.is=e),n.SI=o,u.on("in",g.last=t),s&&(s.hd=+new Date),console.STAT&&console.STAT(e,+new Date-e,t.get?"msg get":t.put?"msg put":"msg"),(r=b(o)).via=n,t.get&&(r.it=t),a&&b(a),g.leap=g.last=null}};function w(t){var n=t.batch,e="string"==typeof n;if(e&&(n+="]"),t.batch=t.tail=null,n&&(e?!(n.length<3):n.length)){if(!e)try{n=1===n.length?n[0]:JSON.stringify(n)}catch(t){return _.log("DAM JSON stringify error",t)}n&&$(n,t)}}function $(n,e){try{var t=e.wire;e.say?e.say(n):t.send&&t.send(n),g.say.d+=n.length||0,++g.say.c}catch(t){(e.queue=e.queue||[]).push(n)}}s.c=s.d=0,function(){var p,h=0;function t(t,n){var e;return n instanceof Object?(Object.keys(n).sort().forEach(o,{to:e={},on:n}),e):n}function o(t){this.to[t]=this.on[t]}g.hash=function(o,i){var r,a,s,u=+new Date;y(o.put,function t(n,e){e=(a=a||(s=e||"")).slice(0,32768);r=T.hash(e,r),(a=a.slice(32768))?v(t,0):(console.STAT&&console.STAT(u,+new Date-u,"say json+hash"),o._.$put=s,o["##"]=r,d(o,i),delete o._.$put)},t)};var d=g.say=function(r,t){var n;if((n=this)&&(n=n.to)&&n.next&&n.next(r),!r)return!1;var e,a,s=r["@"],u=r._||(r._=function(){}),o=r.DBG,i=+new Date;if(u.y=u.y||i,t||o&&(o.y=i),(e=r["#"])||(e=r["#"]=T.random(9)),p||b(e),r.put&&(r.err||(k.s[e]||"").err))return!1;if(r["##"]||x===r.put||u.via||!s){if(!(t=!t&&s?(n=k.s[s])&&(n.via||(n=n.it)&&(n=n._)&&n.via)||(n=g.last)&&s===n["#"]&&g.leap:t)&&s)return k.s[s]?void 0:(console.STAT&&console.STAT(+new Date,++h,"total no peer to ack to"),!1);if(!t&&g.way)return g.way(r);if(o&&(o.yh=+new Date),a=u.raw){if(o&&(o.yr=+new Date),!t||!t.id){if(!T.plain(t||_.peers))return!1;var i=+new Date,c=(_.puff,_.peers),f=Object.keys(t||_.peers||{});return console.STAT&&console.STAT(i,+new Date-i,"peer keys"),void function t(){var n=+new Date;p=1;var e=u.raw;u.raw=a;for(var o,i=0;i<9&&(o=(f||"")[i++]);)(o=c[o])&&d(r,o);u.raw=e,p=0,f=f.slice(i),console.STAT&&console.STAT(n,+new Date-n,"say loop"),f.length&&(v(t,0),s&&b(s))}()}if(!t.wire&&g.wire&&g.wire(t),e!==t.last){if(t.last=e,t===u.via)return!1;if((n=u.yo)&&(n[t.url]||n[t.pid]||n[t.id]))return!1;if(console.STAT&&console.STAT(i,((o||u).yp=+new Date)-(u.y||i),"say prep"),!p&&s&&b(s),t.batch){if(t.tail=(n=t.tail||0)+a.length,t.tail<=_.pack)return void(t.batch+=(n?",":"")+a);w(t)}t.batch="[";var l=+new Date;setTimeout(function(){console.STAT&&console.STAT(l,+new Date-l,"0ms TO"),w(t)},_.gap),$(a,t),console.STAT&&s===t.SI&&console.STAT(i,+new Date-t.SH,"say ack")}}else g.raw(r,t)}else g.hash(r,t)};g.say.c=g.say.d=0,g.raw=function(e,o){if(!e)return"";var i,r=e._||{};if(s=r.raw)return s;if("string"==typeof e)return e;var t=e["##"],n=e["@"];if(t&&n){if(!r.via&&m(n+t))return!1;if((s=(k.s[n]||"").it)||(s=g.last)&&n===s["#"]){if(t===s["##"])return!1;s["##"]||(s["##"]=t)}}if(!e.dam){var a,s,u=0,c=[];for(a in s=_.peers){var f=s[a];if(c.push(f.url||f.pid||f.id),6<++u)break}1<u&&(e["><"]=c.join())}if(i=r.$put)return s={},Object.keys(e).forEach(function(t){s[t]=e[t]}),s.put=":])([:",void y(s,function(t,n){t||(t=+new Date,s=n.indexOf('"put":":])([:"'),l(x,n=n.slice(0,s+6)+i+n.slice(s+14)),console.STAT&&console.STAT(t,+new Date-t,"say slice"))});function l(t,n){t||(r.raw=n,d(e,o))}y(e,l)}}(),g.hi=function(n){var t=n.wire||{};n.id?_.peers[n.url||n.id]=n:(t=n.id=n.id||T.random(9),g.say({dam:"?",pid:u.opt.pid},_.peers[t]=n),delete k.s[n.last]),n.met=n.met||+new Date,t.hied||u.on(t.hied="hi",n),t=n.queue,n.queue=[],Gun.__utils__.setTimeoutEach(t||[],function(t){$(t,n)},0,9)},g.bye=function(t){u.on("bye",t);var n=+new Date;n-=t.met||n,g.bye.time=((g.bye.time||n)+n)/2},g.hear["!"]=function(t,n){_.log("Error:",t.err)},g.hear["?"]=function(t,n){t.pid&&(n.pid||(n.pid=t.pid),t["@"])||(g.say({dam:"?",pid:_.pid,"@":t["#"]},n),delete k.s[n.last])},u.on("create",function(t){t.opt.pid=t.opt.pid||T.random(9),this.to.next(t),t.on("out",g.say)}),u.on("bye",function(t,n){t=_.peers[t.id||t]||t,this.to.next(t),t.bye?t.bye():(n=t.wire)&&n.close&&n.close(),delete _.peers[t.id],t.wire=null});var o={};return u.on("bye",function(t,n){this.to.next(t),(n=console.STAT)&&(n.peers=(n.peers||0)-1),(n=t.url)&&(o[n]=!0,setTimeout(function(){delete o[n]},_.lack||9e3))}),u.on("hi",function(n,e){this.to.next(n),(e=console.STAT)&&(e.peers=(e.peers||0)+1),(e=n.url)&&o[e]&&(delete o[e],_.super||Gun.__utils__.setTimeoutEach(Object.keys(u.next),function(t){u.next[t];(e={})[t]=u.graph[t],e=T.hash(e),g.say({"##":e,get:{"#":t}},n)}))}),g}var x;try{t.exports=n}catch(t){}})(f,"./mesh"),f(function(t){var s=f("../index");s.Mesh=f("./mesh"),s.on("opt",function(t){var o,n,e,i;function r(n){try{if(!n||!n.url)return e&&e(n);var t=n.url.replace(/^http/,"ws"),e=n.wire=new o.WebSocket(t);return e.onclose=function(){o.mesh.bye(n),a(n)},e.onerror=function(t){a(n)},e.onopen=function(){o.mesh.hi(n)},e.onmessage=function(t){t&&o.mesh.hear(t.data||t,n)},e}catch(t){}}function a(n){clearTimeout(n.defer),i&&n.retry<=0||(n.retry=(n.retry||o.retry+1||60)-(-n.tried+(n.tried=+new Date)<4*e?1:0),n.defer=setTimeout(function t(){return i&&i.hidden?setTimeout(t,e):void r(n)},e))}this.to.next(t),t.once||!1!==(o=t.opt).WebSocket&&(n=s.window||{},(n=o.WebSocket||n.WebSocket||n.webkitWebSocket||n.mozWebSocket)&&(o.WebSocket=n,(n=o.mesh=o.mesh||s.Mesh(t)).wire||o.wire,n.wire=o.wire=r,setTimeout(function(){o.super||t.on("out",{dam:"hi"})},1),e=1998,i=""+void 0!=typeof document&&document))})})(f,"./websocket"),f(function(t){if("undefined"!=typeof Gun){var o;try{o=(Gun.window||function(){}).localStorage}catch(t){}o||(Gun.log("Warning: No localStorage exists to persist data to!"),o={setItem:function(t,n){this[t]=n},removeItem:function(t){delete this[t]},getItem:function(t){return this[t]}}),Gun.on("create",function n(e){this.to.next(e);var r,i,a=e.opt,s=(e.graph,[]);if(!1!==a.localStorage){a.prefix=a.file||"gun/";try{r=n[a.prefix]=n[a.prefix]||JSON.parse(o.getItem(a.prefix))||{}}catch(t){r=n[a.prefix]={}}e.on("get",function(t){this.to.next(t);var n,e,o,i=t.get;i&&(n=i["#"])&&((e=r[n]||void 0)&&(o=i["."])&&!Gun.__utils__.plain(o)&&(e=Gun.state.ify({},o,Gun.state.is(e,o),e[o],n)),Gun.on.get.ack(t,e))}),e.on("put",function(t){this.to.next(t);var n=t.put,e=n["#"],o=n["."];r[e]=Gun.state.ify(r[e],o,n[">"],n[":"],e),t["@"]||s.push(t["#"]),i=i||setTimeout(u,a.wait||1)})}function u(){var n,t=s;clearTimeout(i),i=!1,s=[];try{o.setItem(a.prefix,JSON.stringify(r))}catch(t){Gun.log((n=t||"localStorage failure")+" Consider using GUN's IndexedDB plugin for RAD for more storage space, https://gun.eco/docs/RAD#install"),e.on("localStorage:error",{err:n,get:a.prefix,put:r})}(n||Gun.__utils__.empty(a.peers))&&Gun.__utils__.setTimeoutEach(t,function(t){e.on("in",{"@":t,err:n,ok:0})})}})}})(f,"./localStorage")}(),function(){var h,d,g,s,e,n,o,u,i,r,c,f,l,a,p,t,_,v,y,k,m,b,w,$;function T(t,n){y(this,n)&&void 0!==this[n]||(this[n]=t)}function x(t,n){var e=this.n;if(!e||!(n===e||_(e)&&y(e,n)))return void 0!==n||void 0}function j(t,n){return!this.id&&n==e&&o(t)?void(this.id=t):this.id=!1}function S(t,n){if(n!==u._)return!s.is(t)||void(this.cb&&this.cb.call(this.as,t,n,this.n,this.s))}function D(t,n){var e,o=this.o;o.map?void 0===(e=o.map.call(this.as,t,""+n,o.node))?v(o.node,n):o.node&&(o.node[n]=e):s.is(t)&&(o.node[n]=t)}function O(t,n){l!==n&&c.ify(this.o,n,this.s)}function A(t,n){if(!t||n!==u.soul(t)||!u.is(t,this.fn,this.as))return!0;this.cb&&(G.n=t,G.as=this.as,this.cb.call(G.as,t,n,G))}function G(t){t&&u.is(G.n,t,G.as)}function E(t,n){var e;return(e=function(t,n){var e,o=t.seen,i=o.length;for(;i--;)if(e=o[i],n.obj===e.obj)return e;o.push(n)}(t,n))?e:(n.env=t,n.soul=I,u.ify(n.obj,N,n)&&(n.link=n.link||s.link.ify(u.soul(n.node)),n.obj!==t.shell&&(t.graph[s.link.is(n.link)]=n.node)),n)}function N(t,n,e){var o,i,r=this,a=r.env;if(u._===n&&y(t,s.link._))return e._;if(o=B(t,n,e,r,a)){if(n||(r.node=r.node||e||{},y(t,u._)&&u.soul(t)&&(r.node._=w(t._)),r.node=u.soul.ify(r.node,s.link.is(r.link)),r.link=r.link||s.link.ify(u.soul(r.node))),(i=a.map)&&(i.call(a.as||{},t,n,e,r),y(e,n))){if(t=e[n],$===t)return void v(e,n);if(!(o=B(t,n,e,r,a)))return}return n?!0===o?t:(i=E(a,{obj:t,path:r.path.concat(n)})).node?i.link:void 0:r.node}}function I(t){var n=this,e=s.link.is(n.link),o=n.env.graph;n.link=n.link||s.link.ify(t),n.link[s.link._]=t,n.node&&n.node[u._]&&(n.node[u._][s.link._]=t),y(o,e)&&(o[t]=o[e],v(o,e))}function B(t,n,e,o,i){var r;return!!s.is(t)||(_(t)?1:(r=i.invalid)?B(t=r.call(i.as||{},t,n,e),n,e,o,i):(i.err="Invalid value at '"+o.path.concat(n).join(".")+"'!",void(d.list.is(t)&&(i.err+=" Use `.set(item)` instead of an Array."))))}function J(t,n){var e,o;if(u._===n)return k(t,s.link._)?void 0:void(this.obj[n]=w(t));(e=s.link.is(t))?(o=this.opt.seen[e])?this.obj[n]=o:this.obj[n]=this.opt.seen[e]=a.to(this.graph,e,this.opt):this.obj[n]=t}""+$!=typeof Gun&&(h=function(t){console.warn("Warning! Deprecated internal utility will break in next version:",t)},(d=Gun).fn=d.fn||{is:function(t){return h("fn"),!!t&&"function"==typeof t}},d.bi=d.bi||{is:function(t){return h("bi"),t instanceof Boolean||"boolean"==typeof t}},d.num=d.num||{is:function(t){return h("num"),!g(t)&&(0<=t-parseFloat(t)+1||1/0===t||-1/0===t)}},d.text=d.text||{is:function(t){return h("text"),"string"==typeof t}},d.text.ify=d.text.ify||function(t){return h("text.ify"),d.text.is(t)?t:"undefined"!=typeof JSON?JSON.stringify(t):t&&t.toString?t.toString():t},d.text.random=d.text.random||function(t,n){h("text.random");var e="";for(t=t||24,n=n||"0123456789ABCDEFGHIJKLMNOPQRSTUVWXZabcdefghijklmnopqrstuvwxyz";0<t;)e+=n.charAt(Math.floor(Math.random()*n.length)),t--;return e},d.text.match=d.text.match||function(t,n){var e,o;return h("text.match"),"string"==typeof t&&(t===((n=(n="string"==typeof n?{"=":n}:n)||{})["="]||n["*"]||n[">"]||n["<"])||o===n["="]&&(e=n["*"]||n[">"]||n["<"],t.slice(0,(e||"").length)===e||o===n["*"]&&(o!==n[">"]&&o!==n["<"]?t>=n[">"]&&t<=n["<"]:o!==n[">"]&&t>=n[">"]||o!==n["<"]&&t<=n["<"])))},d.text.hash=d.text.hash||function(t,n){if(h("text.hash"),"string"==typeof t){if(n=n||0,!t.length)return n;for(var e=0,o=t.length;e<o;++e)n=(n<<5)-n+t.charCodeAt(e),n|=0;return n}},d.list=d.list||{is:function(t){return h("list"),t instanceof Array}},d.list.slit=d.list.slit||Array.prototype.slice,d.list.sort=d.list.sort||function(e){return h("list.sort"),function(t,n){return t&&n?(t=t[e])<(n=n[e])?-1:n<t?1:0:0}},d.list.map=d.list.map||function(t,n,e){return h("list.map"),b(t,n,e)},d.list.index=1,d.obj=d.boj||{is:function(t){return h("obj"),!!t&&(t instanceof Object&&t.constructor===Object||"Object"===Object.prototype.toString.call(t).match(/^\[object (\w+)\]$/)[1])}},d.obj.put=d.obj.put||function(t,n,e){return h("obj.put"),(t||{})[n]=e,t},d.obj.has=d.obj.has||function(t,n){return h("obj.has"),t&&Object.prototype.hasOwnProperty.call(t,n)},d.obj.del=d.obj.del||function(t,n){if(h("obj.del"),t)return t[n]=null,delete t[n],t},d.obj.as=d.obj.as||function(t,n,e,o){return h("obj.as"),t[n]=t[n]||(o===e?{}:e)},d.obj.ify=d.obj.ify||function(n){if(h("obj.ify"),_(n))return n;try{n=JSON.parse(n)}catch(t){n={}}return n},d.obj.to=d.obj.to||function(t,n){return h("obj.to"),b(t,T,n=n||{}),n},d.obj.copy=d.obj.copy||function(t){return h("obj.copy"),t&&JSON.parse(JSON.stringify(t))},d.obj.empty=d.obj.empty||function(t,n){return h("obj.empty"),!t||!b(t,x,{n:n})},function(){function l(t,n){if(2===arguments.length)return l.r=l.r||{},void(l.r[t]=n);l.r=l.r||[],l.r.push(t)}Object.keys||(Object.keys=function(t){return n(t,function(t,n,e){e(n)})});var n,p=Object.keys;d.obj.map=n=d.obj.map||function(t,n,e){h("obj.map");var o,i,r,a,s,u=0,c="function"==typeof n;if(l.r=o,p&&_(t)&&(a=p(t),s=!0),e=e||{},g(t)||a)for(i=(a||t).length;u<i;u++){var f=u+d.list.index;if(c){if((r=s?n.call(e,t[a[u]],a[u],l):n.call(e,t[u],f,l))!==o)return r}else if(n===t[s?a[u]:u])return a?a[u]:f}else for(u in t)if(c){if(y(t,u)&&(r=e?n.call(e,t[u],u,l):n(t[u],u,l))!==o)return r}else if(n===t[u])return u;return c?l.r:d.list.index?0:-1}}(),d.time=d.time||{},d.time.is=d.time.is||function(t){return h("time"),t?t instanceof Date:+(new Date).getTime()},p=d.fn.is,g=d.list.is,t=d.obj,_=t.is,y=t.has,b=t.map,(s={is:function(t){return h("val.is"),t!==$&&(null===t||t!==1/0&&(!!(o(t)||n(t)||f(t))||(s.link.is(t)||!1)))}}).link=s.rel={_:"#"},s.link.is=function(t){if(h("val.link.is"),t&&t[e]&&!t._&&_(t)){var n={};if(b(t,j,n),n.id)return n.id}return!1},s.link.ify=function(t){return h("val.link.ify"),m({},e,t)},d.obj.has._=".",e=s.link._,n=d.bi.is,f=d.num.is,o=d.text.is,_=(t=d.obj).is,m=t.put,b=t.map,d.val=d.val||s,(u={_:"_",soul:function(t,n){return h("node.soul"),t&&t._&&t._[n||r]}}).soul.ify=function(t,n){return h("node.soul.ify"),n="string"==typeof n?{soul:n}:n||{},(t=t||{})._=t._||{},t._[r]=n.soul||t._[r]||i(),t},u.soul._=s.link._,u.is=function(t,n,e){var o;return h("node.is"),!!_(t)&&(!!(o=u.soul(t))&&!b(t,S,{as:e,cb:n,s:o,n:t}))},u.ify=function(t,n,e){return h("node.ify"),n?"string"==typeof n?n={soul:n}:"function"==typeof n&&(n={map:n}):n={},n.map&&(n.node=n.map.call(e,t,$,n.node||{})),(n.node=u.soul.ify(n.node||{},n))&&b(t,D,{o:n,as:e}),n.node},_=(t=d.obj).is,v=t.del,b=t.map,i=d.text.random,r=u.soul._,d.node=d.node||u,(c=d.state).lex=function(){return h("state.lex"),c().toString(36).replace(".","")},c.to=function(t,n,e){h("state.to");var o=(t||{})[n];return _(o)&&(o=w(o)),c.ify(e,n,c.is(t,n),o,u.soul(t))},c.map=function(i,r,a){h("state.map");var t=_(t=i||r)?t:null;return i=p(i=i||r)?i:null,t&&!i?(r=f(r)?r:c(),t[l]=t[l]||{},b(t,O,{o:t,s:r}),t):(a=a||_(r)?r:void 0,r=f(r)?r:c(),function(t,n,e,o){if(!i)return O.call({o:e,s:r},t,n),t;i.call(a||this||{},t,n,e,o),y(e,n)&&void 0===e[n]||O.call({o:e,s:r},t,n)})},(t=d.obj).as,y=t.has,_=t.is,b=t.map,w=t.copy,f=d.num.is,p=d.fn.is,l=u._,a={is:function(t,n,e,o){return h("graph.is"),!(!t||!_(t)||k(t))&&!b(t,A,{cb:n,fn:e,as:o})},ify:function(t,n,e){h("graph.ify");t={path:[],obj:t};return n?"string"==typeof n?n={soul:n}:"function"==typeof n&&(n.map=n):n={},"string"==typeof e&&(n.soul=n.soul||e,e=$),n.soul&&(t.link=s.link.ify(n.soul)),n.shell=(e||{}).shell,n.graph=n.graph||{},n.seen=n.seen||[],n.as=n.as||e,E(n,t),n.root=t.node,n.graph},node:function(t){h("graph.node");var n=u.soul(t);if(n)return m({},n,t)},to:function(t,n,e){if(h("graph.to"),t){var o={};return b(t[n],J,{obj:o,graph:t,opt:e=e||{seen:{}}}),o}}},p=d.fn.is,_=(t=d.obj).is,v=t.del,y=t.has,k=t.empty,m=t.put,b=t.map,w=t.copy,d.graph=d.graph||a)}();