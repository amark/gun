!function(){function x(e,t){return t?require(e):e.slice?x[o(e)]:function(t,n){e(t={exports:{}}),x[o(n)]=t.exports};function o(t){return t.split("/").slice(-1).toString().replace(".js","")}}var n;"undefined"!=typeof module&&(n=module),x(function(t){String.random=function(t,n){var e="";for(t=t||24,n=n||"0123456789ABCDEFGHIJKLMNOPQRSTUVWXZabcdefghijklmnopqrstuvwxyz";0<t--;)e+=n.charAt(Math.floor(Math.random()*n.length));return e},String.match=function(t,n){var e,o;return"string"==typeof t&&(t===((n=(n="string"==typeof n?{"=":n}:n)||{})["="]||n["*"]||n[">"]||n["<"])||o===n["="]&&(e=n["*"]||n[">"],t.slice(0,(e||"").length)===e||o===n["*"]&&(o!==n[">"]&&o!==n["<"]?t>=n[">"]&&t<=n["<"]:o!==n[">"]&&t>=n[">"]||o!==n["<"]&&t<=n["<"])))},String.hash=function(t,n){if("string"==typeof t){if(n=n||0,!t.length)return n;for(var e=0,o=t.length;e<o;++e)n=(n<<5)-n+t.charCodeAt(e),n|=0;return n}};var n,e,o,i,r,s,a,u,c,f,l,h,p,d,g,v,y=Object.prototype.hasOwnProperty;Object.plain=function(t){return!!t&&(t instanceof Object&&t.constructor===Object||"Object"===Object.prototype.toString.call(t).match(/^\[object (\w+)\]$/)[1])},Object.empty=function(t,n){for(var e in t)if(y.call(t,e)&&(!n||-1==n.indexOf(e)))return!1;return!0},Object.keys=Object.keys||function(t){var n,e=[];for(n in t)y.call(t,n)&&e.push(n);return e},o=setTimeout,r=i=0,s=typeof setImmediate!=""+g&&setImmediate||(typeof MessageChannel==""+g?o:((n=new MessageChannel).port1.onmessage=function(t){""==t.data&&e()},function(t){e=t,n.port2.postMessage("")})),a=o.check=o.check||typeof performance!=""+g&&performance||{now:function(){return+new Date}},o.hold=o.hold||9,o.poll=o.poll||function(t){o.hold>=a.now()-i&&r++<3333?t():s(function(){i=a.now(),t()},r=0)},g=setTimeout,f=(c=g.turn=g.turn||function(t){1==f.push(t)&&l(p)}).s=[],l=g.poll,h=0,p=function(){(u=f[h++])&&u(),h!=f.length&&99!=h||(f=c.s=f.slice(h),h=0),f.length&&l(p)},g=setTimeout,v=g.turn,(g.each=g.each||function(r,s,a,u){u=u||9,function t(n,e,o){if(e=(n=(r||[]).splice(0,u)).length){for(var i=0;i<e&&d===(o=s(n[i]));i++);if(d===o)return void v(t)}a&&a(o)}()})()})(x,"./shim"),x(function(t){t.exports=function t(n,e,o){if(!n)return{to:t};var i="function"==typeof e,n=(this.tag||(this.tag={}))[n]||i&&(this.tag[n]={tag:n,to:t._={next:function(t){var n;(n=this.to)&&n.next(t)}}});if(i){o={off:t.off||(t.off=function(){if(this.next===t._.next)return!0;this===this.the.last&&(this.the.last=this.back),this.to.back=this.back,this.next=t._.next,this.back.to=this.to,this.the.last===this.the&&delete this.on.tag[this.the.tag]}),to:t._,next:e,the:n,on:this,as:o};return(o.back=n.last||n).to=o,n.last=o}return(n=n.to)&&void 0!==e&&n.next(e),n}})(x,"./onto"),x(function(t){var n=setTimeout,u=n.Book||(n.Book=function(t){function i(t,n){var e,o=i.all[t];return void 0===n?o&&o.is||i.get(o||t):o?((e=o.page)&&(e.size+=p(n)-p(o.is),e.text=""),o.text="",o.is=n,i):i.set(t,n)}return i.list=[{from:t,size:(t||"").length,substring:v,toString:y,book:i,get:i,read:l}],i.page=e,i.set=s,i.get=o,i.all={},i}),r=4096;function e(t){var n=this,e=n.list,o=c(t,e,n.parse),t=e[o];return"string"==typeof t&&(e[o]=t={size:-1,first:n.parse?n.parse(t):t,substring:v,toString:y,book:n,get:n,read:l}),t}function o(t){if(t){if(void 0!==t.is)return t.is;var n=this.all[t];if(n)return n.is;n=this.page(t);return n&&n.from?a(t,n):void 0}}function a(t,n){var e,o,i,r,s=n.book;return(o=(e=f(n))?e[a.i=r=c(t,e,u.decode)]:o)&&t==o.word||(o="string"!=typeof o?e[a.i=r+=1]:o)&&t==o.word?(s.all[t]=o).is:(i=h(o),t==u.decode(i[0])||(i=h(o=e[a.i=r+=1]),t==u.decode(i[0]))?(o=e[r]=s.all[t]={word:""+t,is:u.decode(i[1]),page:n,substring:d,toString:g}).is:void 0)}function c(t,n,e){e=e||c.no||(c.no=function(t){return t});for(var o,i=n,r=0,s=(t=""+t,i.length),a=s/2;(t<(o=(e(i[a>>=0])||"").substring())||(e(i[a+1])||"").substring()<=t)&&a!=r;)a+=o<=t?(s-(r=a))/2:-((s=a)-r)/2;return a}function f(t,n){return"string"!=typeof t.from?t.from:t.from=h(n=n||t.from||"")}function l(t){t=t||function(t){return t};for(var n,e=0,o=m(this),i=[],r=this.book.parse||function(){};n=o[e++];)i.push(t(this.get(n=n.word||r(n)||n),n,this));return i}function s(t,n){var e,o=this;if(e=o.all[t])return o(t,n);var i=o.page(t=""+t);return i&&i.from&&(o.get(t),o.all[t])?o(t,n):(e=o.all[t]={word:t,is:n,page:i,substring:d,toString:g},i.first=i.first<t?i.first:t,i.limbo||(i.limbo=[]),i.limbo.push(e),o(t,n),i.size+=p(t)+p(n),(o.PAGE||r)<i.size&&function(t,n){var e,o=m(t),i=o.length/2>>0,r=i,s={first:o[r].substring(),size:0,substring:v,toString:y,book:n,get:n,read:l},a=s.from=[];for(;e=o[i++];)a.push(e),s.size+=(e.is||"").length||1,e.page=s;t.from=t.from.slice(0,r),t.size-=s.size,n.list.splice(c(s.first,n.list)+1,0,s),n.split&&n.split(s,t)}(i,o),o)}function h(t){return function t(n,e){var o,i;if((o=n.indexOf(""))<0)return n;if(""==n[0]&&1==n.length)return[];if((i=o+2+parseInt((i=n[o+1]).substring(0,i.indexOf('"'))||i))!=i)return[];n[o]=n.slice(o,i).join(e||"|");return n.slice(0,o+1).concat(t(n.slice(i),e))}((t=t||"").substring(1,t.length-1).split(t[0]),t[0])}function p(t){return(t||"").length||1}function d(t,n){return this.word}function g(){return this.text=this.text||":"+u.encode(this.word)+":"+u.encode(this.is)+":"}function v(t,n){return(this.first||this.word||u.decode((f(this)||"")[0]||"")).substring(t,n)}function y(){return this.text=this.text||function(t){t.limbo&&m(t);return"string"==typeof t.from?t.from:"|"+(t.from||[]).join("|")+"|"}(this)}function m(t,n){var e=t.from="string"==typeof t.from?h(t.from):t.from||[];return(n=n||t.limbo)?function(t,n){n=n||t.limbo||[],t.limbo=null;var e,o=0,i=t.from;for(;e=n[o++];)a(e.word,t)?i[a.i]=e:i.push(e);return i}(t).sort(function(t,n){return(t.word||u.decode(""+t))<(n.word||u.decode(""+n))?-1:1}):e}u.slot=h,u.encode=function(t,n,e){switch(n=n||"|",e=e||String.fromCharCode(32),typeof t){case"string":for(var o=t.indexOf(n),i=0;-1!=o;)i++,o=t.indexOf(n,o+1);return(i?n+i:"")+'"'+t;case"number":return t<0?""+t:"+"+t;case"boolean":return t?"+":"-";case"object":if(!t)return" ";for(var r,s=Object.keys(t).sort(),o=0,a=n;r=s[o++];)a+=e+u.encode(r,n,e)+e+u.encode(t[r],n,e)+e+n;return a}},u.decode=function(t,n){if("string"==typeof t){switch(t){case" ":return null;case"-":return!1;case"+":return!0}switch(t[0]){case"-":case"+":return parseFloat(t);case'"':return t.slice(1)}return t.slice(t.indexOf('"')+1)}},u.hash=function(t,n){if("string"==typeof t){if(n=n||0,!t.length)return n;for(var e=0,o=t.length;e<o;++e)n=(n<<5)-n+t.charCodeAt(e),n|=0;return n}};try{t.exports=u}catch(t){}})(x,"./book"),x(function(t){t.exports=function(t){return null===t||"string"==typeof t||"boolean"==typeof t||"number"==typeof t&&t!=1/0&&t!=-1/0&&t==t||!!t&&"string"==typeof t["#"]&&1===Object.keys(t).length&&t["#"]}})(x,"./valid"),x(function(t){function n(){var t=+new Date;return i=i<t?(e=0,t+n.drift):t+(e+=1)/o+n.drift}x("./shim");n.drift=0;var e=0,o=999,i=-1/0;n.is=function(t,n,e){e=n&&t&&t._&&t._[">"]||e;if(e)return"number"==typeof(e=e[n])?e:-1/0},n.ify=function(t,n,e,o,i){(t=t||{})._=t._||{},i&&(t._["#"]=i);i=t._[">"]||(t._[">"]={});return void 0!==n&&"_"!==n&&("number"==typeof e&&(i[n]=e),void 0!==o&&(t[n]=o)),t},t.exports=n})(x,"./state"),x(function(t){x("./shim"),t.exports=function(o){var i={s:{}},r=i.s;o=o||{max:999,age:9e3},i.check=function(t){return!!r[t]&&e(t)};var e=i.track=function(t){var n=r[t]||(r[t]={});return n.was=i.now=+new Date,i.to||(i.to=setTimeout(i.drop,o.age+9)),e.ed&&e.ed(t),n};return i.drop=function(e){i.to=null,i.now=+new Date;var t=Object.keys(r);console.STAT&&console.STAT(i.now,+new Date-i.now,"dup drop keys"),setTimeout.each(t,function(t){var n=r[t];n&&(e||o.age)>i.now-n.was||delete r[t]},0,99)},i}})(x,"./dup"),x(function(t){x("./onto"),t.exports=function(t,n){if(this.on){var e=(this.opt||{}).lack||9e3;if("function"!=typeof t){if(!t)return;var o=t["#"]||t,i=(this.tag||"")[o];return i?(n&&(i=this.on(o,n),clearTimeout(i.err),i.err=setTimeout(function(){i.off()},e)),!0):void 0}o=n&&n["#"]||s(9);if(!t)return o;var r=this.on(o,t,n);return r.err=r.err||setTimeout(function(){r.off(),r.next({err:"Error: No ACK yet.",lack:!0})},e),o}};var s=String.random||function(){return Math.random().toString(36).slice(2)}})(x,"./ask"),x(function(t){function f(t){return t instanceof f?(this._={$:this}).$:this instanceof f?f.create(this._={$:this,opt:t}):new f(t)}function a(t,s){var a=+new Date,n=t._||{},u=n.DBG=t.DBG,c=t["#"],f=g(9),l=Object.keys(s||"").sort(),h=((s||"")._||"")["#"],p=(l.length,t.$._.root),d=s===p.graph[h];console.STAT&&console.STAT(a,((u||n).gk=+new Date)-a,"got keys"),s&&function t(){a=+new Date;for(var n,e,o,i=0,r={};i<9&&(n=l[i++]);)v(r,n,G(s,n),s[n],h);l=l.slice(i),(e={})[h]=r,r=e,d&&((o=function(){}).ram=o.faith=!0),e=l.length,console.STAT&&console.STAT(a,-(a-(a=+new Date)),"got copied some"),u&&(u.ga=+new Date),p.on("in",{"@":c,"#":f,put:r,"%":e?f=g(9):O,$:p.$,_:o,DBG:u}),console.STAT&&console.STAT(a,+new Date-a,"got in"),e&&setTimeout.turn(t)}(),s||p.on("in",{"@":t["#"]})}f.is=function(t){return t instanceof f||t&&t._&&t===t._.$||!1},f.version=.202,(f.chain=f.prototype).toJSON=function(){},x("./shim"),f.valid=x("./valid"),f.state=x("./state"),f.on=x("./onto"),f.dup=x("./dup"),f.ask=x("./ask"),function(){function b(t){if(t)if(t.out!==b){var n,e,o=this.as,i=o.at||o,r=i.$,s=i.dup,a=t.DBG;if((e=t["#"])||(e=t["#"]=g(9)),!s.check(e)){if(s.track(e),e=t._,t._="function"==typeof e?e:function(){},t.$&&t.$===(t.$._||"").$||(t.$=r),t["@"]&&!t.put&&(s=(o=t)["@"]||"",(n=s._)?(n.acks=(n.acks||0)+1,(n.err=o.err)&&(o["@"]=n["#"],w(n)),n.ok=o.ok||n.ok,n.stop||n.crack||(n.crack=n.match&&n.match.push(function(){c(n)})),c(n)):(e=(e=(e=o.$)&&(e=e._)&&(e=e.root)&&e.dup).check(s))&&(o["@"]=e["#"]||o["@"])),!i.ask(t["@"],t)){if(a&&(a.u=+new Date),t.put)return void u(t);t.get&&f.on.get(t,r)}a&&(a.uc=+new Date),this.to.next(t),a&&(a.ua=+new Date),t.nts||t.NTS||(t.out=b,i.on("out",t),a&&(a.ue=+new Date))}}else this.to.next(t)}function u(s){if(s){var a=s._||"",t=a.root=((a.$=s.$||"")._||"").root;if(s["@"]&&a.faith&&!a.miss)return s.out=b,void t.on("out",s);a.latch=t.hatch,a.match=t.hatch=[];var u,c,f,l,h,p,d,g,v,y=s.put,m=a.DBG=s.DBG,k=+new Date;n=n||k,y["#"]&&y["."]||(m&&(m.p=k),a["#"]=s["#"],a.msg=s,a.all=0,a.stun=1,u=Object.keys(y),console.STAT&&console.STAT(k,((m||a).pk=+new Date)-k,"put sort"),c=0,function t(n){if(f!=c){if(!(h=u[f=c]))return console.STAT&&console.STAT(k,((m||a).pd=+new Date)-k,"put"),void w(a);(p=y[h])?(v=p._)?h!==v["#"]?g=_+$(h)+"soul not same.":(d=v[">"])||(g=_+$(h)+"no state."):g=_+$(h)+"no meta.":g=_+$(h)+"no node.",l=Object.keys(p||{})}if(g)return s.err=a.err=g,void w(a);var e,o=0;for(n=n||0;n++<9&&(e=l[o++]);)if("_"!==e){var i=p[e],r=d[e];if(O===r){g=_+$(e)+"on"+$(h)+"no state.";break}if(!A(i)){g=_+$(e)+"on"+$(h)+"bad "+typeof i+$(i);break}!function t(n,e,o,i,r){var s=r._||"",a=s.root,u=a.graph;var c=u[o]||N,f=G(c,e,1),l=c[e];var h=s.DBG;(c=console.STAT)&&(u[o]&&l||(c.has=(c.has||0)+1));u=T();if(u<i)return setTimeout(function(){t(n,e,o,i,r)},(c=i-u)>j?j:c),void(console.STAT&&console.STAT((h||s).Hf=+new Date,c,"future"));if(i<f)return void 0;if(!s.faith&&i===f&&(n===l||x(n)<=x(l))&&!s.miss)return;s.stun++;var p=r["#"]+s.all++,l={toString:function(){return p},_:s};l.toJSON=l.toString;a.dup.track(l)["#"]=r["#"];h&&(h.ph=h.ph||+new Date);a.on("put",{"#":l,"@":r["@"],put:{"#":o,".":e,":":n,">":i},ok:r.ok,_:s})}(i,e,h,r,s),++S}(l=l.slice(o)).length?D(t):(++c,l=null,t(n))}())}}function e(t){(u=(t._||"").DBG)&&(u.pa=+new Date,u.pm=u.pm||+new Date);var n=this.as,e=n.graph,o=t._,i=t.put,r=i["#"],s=i["."],a=i[":"],u=i[">"];t["#"];(i=o.msg)&&(i=i.put)&&(i=i[r])&&v(i,s,u,a,r),e[r]=v(e[r],s,u,a,r),(i=(n.next||"")[r])&&i.on("in",t),w(o),this.to.next(t)}function w(t,n){var e,o;t.stop||!t.err&&0<--t.stun||(t.stop=1,(e=t.root)&&((o=t.match).end=1,o===e.hatch&&(!(o=t.latch)||o.end?delete e.hatch:e.hatch=o),t.hatch&&t.hatch(),setTimeout.each(t.match,function(t){t&&t()}),!(n=t.msg)||t.err||n.err||(n.out=b,t.root.on("out",n),i())))}function c(t){t&&t.root&&(t.stun||t.acks!==t.all||t.root.on("in",{"@":t["#"],err:t.err,ok:t.err?O:t.ok||{"":1}}))}f.create=function(t){t.root=t.root||t,t.graph=t.graph||{},t.on=t.on||f.on,t.ask=t.ask||f.ask,t.dup=t.dup||f.dup();var n=t.$.opt(t.opt);return t.once||(t.on("in",b,t),t.on("out",b,t),t.on("put",e,t),f.on("create",t),t.on("create",t)),t.once=1,n},f.on.put=u;var n,_="Error: Invalid graph!",$=function(t){return" '"+(""+t).slice(0,9)+"...' "},x=JSON.stringify,j=2147483647,T=f.state,S=0,i=function(){999<S&&1<S/-(n-(n=+new Date))&&(f.window&&console.log("Warning: You're syncing 1K+ records a second, faster than DOM can update - consider limiting query."),i=function(){S=0})}}(),f.on.get=function(t,n){var e=n._,o=t.get,i=o["#"],r=e.graph[i],s=o["."],n=(e.next||(e.next={}))[i],o=(t._||{}).DBG=t.DBG;if(o&&(o.g=+new Date),!r)return e.on("get",t);if(s){if(("string"!=typeof s||O===r[s])&&!((n||"").next||"")[s])return void e.on("get",t);r=v({},s,G(r,s),r[s],i)}r&&a(t,r),e.on("get",t)},f.on.get.ack=a,f.chain.opt=function(e){e=e||{};var o=this._,t=e.peers||e;return Object.plain(e)||(e={}),Object.plain(o.opt)||(o.opt=e),"string"==typeof t&&(t=[t]),Object.plain(o.opt.peers)||(o.opt.peers={}),t instanceof Array&&(e.peers={},t.forEach(function(t){var n={};n.id=n.url=t,e.peers[t]=o.opt.peers[t]=o.opt.peers[t]||n})),i(e,function t(n){var e=this[n];this&&this.hasOwnProperty(n)||"string"==typeof e||Object.empty(e)?this[n]=e:(!e||e.constructor===Object||e instanceof Array)&&i(e,t)}),o.opt.from=e,f.on("opt",o),o.opt.uuid=o.opt.uuid||function(t){return f.state().toString(36).replace(".","")+String.random(t||12)},this};var O,e,i=function(t,n){Object.keys(t).forEach(n,t)},g=String.random,D=setTimeout.turn,A=f.valid,G=f.state.is,v=f.state.ify,N={};(f.log=function(){return f.log.off||e.log.apply(e,arguments),[].slice.call(arguments).join(" ")}).once=function(t,n,e){return(e=f.log.once)[t]=e[t]||0,e[t]++||f.log(n)},"undefined"!=typeof window&&((window.GUN=window.Gun=f).window=window);try{void 0!==n&&(n.exports=f)}catch(t){}((t.exports=f).window||{}).console=(f.window||{}).console||{log:function(){}},(e=console).only=function(t,n){return e.only.i&&t===e.only.i&&e.only.i++&&(e.log.apply(e,arguments)||n)}})(x,"./root"),x(function(t){x("./root").chain.back=function(t,n){if(-1===(t=t||1)||1/0===t)return this._.root.$;if(1===t)return(this._.back||this._).$;var e=this._;if((t="string"==typeof t?t.split("."):t)instanceof Array){for(var o=0,i=t.length,r=e;o<i;o++)r=(r||a)[t[o]];return void 0!==r?n?this:r:(r=e.back)?r.$.back(t,n):void 0}if("function"!=typeof t)return"number"==typeof t?(e.back||e).$.back(t-1):this;for(var s,r={back:e};(r=r.back)&&void 0===(s=t(r,n)););return s};var a={}})(x,"./back"),x(function(t){var r=x("./root");function l(t,n){if(n=n||this.as||t.$._,(!t.$$||this===r.on)&&t.put&&!n.soul){var e=t.put||"",o=e["="]||e[":"],t=n.root,e=t.$.get(e["#"]).get(e["."])._;if("string"==typeof(o=g(o))){if(!(e.echo||(e.echo={}))[n.id]||(t.pass||"")[n.id]){if(i=t.pass){if(i[o+n.id])return;i[o+n.id]=1}((e.echo||(e.echo={}))[n.id]=n).has&&(n.link=o);var i,t=t.$.get(e.link=o)._;(t.echo||(t.echo={}))[e.id]=e,((i=n.ask||"")[""]||n.lex)&&t.on("out",{get:{"#":o}}),setTimeout.each(Object.keys(i),function(t,n){t&&(n=i[t])&&n.on("out",{get:{"#":o,".":t}})},0,99)}}else this===r.on&&((e.echo||(e.echo={}))[n.id]=n)}}function h(t,e){var o,n,i=t.put||"",i=p!==i["="]?i["="]:i[":"],r=e.root;if(p===i)return e.soul&&p!==e.put?void 0:(n=(t.$$||t.$||"")._||"",!t["@"]||p===n.put&&p===e.put?((o=e.link||t.linked)&&delete(r.$.get(o)._.echo||"")[e.id],e.has&&(e.link=null),e.put=p,void setTimeout.each(Object.keys(e.next||""),function(t,n){(n=e.next[t])&&(o&&delete(r.$.get(o).get(t)._.echo||"")[n.id],n.on("in",{get:t,put:p,$:n.$}))},0,99)):void 0);e.soul||t.$$||(o=g(i),n=t.$._||"",(o!==n.link&&(!e.has||n.link)||(r.pass||"")[e.id]&&"string"!=typeof o)&&(delete(n.echo||"")[e.id],h({get:e.get,put:p,$:t.$,linked:t.linked=t.linked||n.link},e)))}function s(t,n){var e=this.as,o=e.$._,i=(o.root,e.get||""),e=(t.put||"")[i["#"]]||"";if(!t.put||"string"==typeof i["."]&&p===e[i["."]])return p===o.put&&(o.soul||o.has)?(o.ack=(o.ack||0)+1,void o.on("in",{get:o.get,put:o.put=p,$:o.$,"@":t["@"]})):void 0;(t._||{}).miss=1,r.on.put(t)}r.chain.chain=function(t){var n=this,e=n._,o=new(t||n).constructor(n),t=o._;return t.root=e=e.root,t.id=++e.once,t.back=n._,t.on=r.on,t.on("in",r.on.in,t),t.on("out",r.on.out,t),o},r.on.out=function(t){var n,e,o=this.as,i=o.back,r=o.root;if(t.$||(t.$=o.$),this.to.next(t),!o.err){if(n=t.get){if(r.pass&&(r.pass[o.id]=o),o.lex&&Object.keys(o.lex).forEach(function(t){e[t]=o.lex[t]},e=t.get=t.get||{}),n["#"]||o.soul){if(n["#"]=n["#"]||o.soul,t["#"]||(t["#"]=a(9)),i=r.$.get(n["#"])._,n=n["."]){if(u(i.put,n)&&(e=i.ask&&i.ask[n],(i.ask||(i.ask={}))[n]=i.$.get(n)._,i.on("in",{get:n,put:{"#":i.soul,".":n,":":i.put[n],">":v(r.graph[i.soul],n)}}),e))return}else{if(e=i.ask&&i.ask[""],(i.ask||(i.ask={}))[""]=i,p!==i.put&&(i.on("in",i),e))return;t.$=i.$}return r.ask(s,t),r.on("in",t)}if(n["."])return o.get?(t={get:{".":o.get},$:o.$},(i.ask||(i.ask={}))[o.get]=t.$._):t={get:o.lex?t.get:{},$:o.$},i.on("out",t);if(((o.ask||(o.ask={}))[""]=o).get)return n["."]=o.get,(i.ask||(i.ask={}))[o.get]=t.$._,i.on("out",t)}return i.on("out",t)}o.on("in",{put:o.put=p,$:o.$})},r.on.in=function(n,e){var o,t,i=(e=e||this.as).root,r=((o=n.$||(n.$=e.$))||"")._||d,s=n.put||"",a=s["#"],u=s["."],c=p!==s["="]?s["="]:s[":"],f=s[">"]||-1/0;if(p!==n.put&&(p===s["#"]||p===s["."]||p===s[":"]&&p===s["="]||p===s[">"]))return g(s)?void e.on("in",{$:r.back.$,put:{"#":a=r.back.soul,".":u=r.has||r.get,"=":s,">":v(r.back.put,u)},via:n}):(a=((s||"")._||"")["#"])?(o=e.root.$.get(a),setTimeout.each(Object.keys(s).sort(),function(t){"_"!=t&&p!==(f=v(s,t))&&e.on("in",{$:o,put:{"#":a,".":t,"=":s[t],">":f},VIA:n})})):void console.log("chain not yet supported for",s,"...",n,e);(n.seen||"")[e.id]||(((n.seen||(n.seen=function(){}))[e.id]=e)!==r&&(Object.keys(n).forEach(function(t){s[t]=n[t]},s={}),s.get=e.get||s.get,e.soul||e.has?r.soul&&(s.$=e.$,s.$$=s.$$||r.$):s.$$$=s.$$$||e.$,n=s),h(n,e),(e.soul||n.$$)&&f>=v(i.graph[a],u)&&((s=i.$.get(a)._).put=y(s.put,u,f,c,a)),!r.soul&&f>=v(i.graph[a],u)&&(t=(i.$.get(a)._.next||"")[u])&&(t.put=c,"string"==typeof(s=g(c))&&(t.put=i.$.get(s)._.put||c)),this.to&&this.to.next(n),e.any&&setTimeout.each(Object.keys(e.any),function(t){(t=e.any[t])&&t(n)},0,99),e.echo&&setTimeout.each(Object.keys(e.echo),function(t){(t=e.echo[t])&&t.on("in",n)},0,99),((n.$$||"")._||r).soul&&(t=e.next)&&(t=t[u])&&(s={},Object.keys(n).forEach(function(t){s[t]=n[t]}),s.$=(n.$$||n.$).get(s.get=u),delete s.$$,delete s.$$$,t.on("in",s)),l(n,e))},r.on.link=l,r.on.unlink=h;var p,d={},a=String.random,g=r.valid,u=function(t,n){return t&&Object.prototype.hasOwnProperty.call(t,n)},n=r.state,v=n.is,y=n.ify})(x,"./chain"),x(function(t){var g=x("./root");function r(t){var n=this.at||this.on;if(!t||n.soul||n.has)return this.off();if(t=(t=(t=t.$||t)._||t).id){n.map;if((n=this.seen||(this.seen={}))[t])return!0;n[t]=!0}}g.chain.get=function(t,n,e){var o;if("string"==typeof t){if(0==t.length)return(i=this.chain())._.err={err:g.log("0 length key!",t)},n&&n.call(i,i._.err),i;var i=(i=!(i=((f=this._).next||s)[t])?t&&function(t,n){var e=n._,o=e.next,i=n.chain()._;o=o||(e.next={});o[i.get=t]=i,n===e.root.$?i.soul=t:(e.soul||e.has)&&(i.has=t);return i}(t,this):i)&&i.$}else{if("function"==typeof t){if(!0===n)return function(t,n,e){var s,a=t._,u=0;if(s=a.soul||a.link)return n(s,e,a);if(a.jam)return a.jam.push([n,e]);a.jam=[[n,e]],t.get(function(t,n){if(!(v===t.put&&!a.root.opt.super&&(s=Object.keys(a.root.opt.peers).length)&&++u<=s)){n.rid(t);var e=(e=t.$)&&e._||{},o=0;for(s=a.jam,delete a.jam;r=s[o++];){var i=r[0],r=r[1];i&&i(e.link||e.soul||g.valid(t.put)||((t.put||{})._||{})["#"],r,t,n)}}},{out:{get:{".":!0}}})}(this,t,e),this;var c,f=(i=this)._,l=n||{},h=f.root;l.at=f,l.ok=t;var p={};function d(n,t,e){if(!d.stun&&(!(o=h.pass)||o[c])){var o,i=n.$._,r=(n.$$||"")._,s=(r||i).put,a=!i.has&&!i.soul,u={};if(!a&&v!==s||(s=v===((o=n.put)||"")["="]?v===(o||"")[":"]?o:o[":"]:o["="]),"string"==typeof(o=g.valid(s))&&(s=v===(o=h.$.get(o)._.put)?l.not?v:s:o),!l.not||v!==s){if(v===l.stun){if((o=h.stun)&&o.on&&(f.$.back(function(t){if(o.on(""+t.id,u={}),(u.run||0)<d.id)return u}),u.run||o.on(""+i.id,u={}),!u.run&&r&&o.on(""+r.id,u={}),d.id>u.run&&(u.stun&&!u.stun.end||(u.stun=o.on("stun"),u.stun=u.stun&&u.stun.last),u.stun&&!u.stun.end)))return void((u.stun.add||(u.stun.add={}))[c]=function(){d(n,t,1)});if(v===s&&(e=0),(o=h.hatch)&&!o.end&&v===l.hatch&&!e)return p[i.$._.id]?void 0:(p[i.$._.id]=1,void o.push(function(){d(n,t,1)}));p={}}if(h.pass){if(h.pass[c+i.id])return;h.pass[c+i.id]=1}l.on?l.ok.call(i.$,s,i.get,n,t||d):l.v2020?l.ok(n,t||d):(Object.keys(n).forEach(function(t){o[t]=n[t]},o={}),(n=o).put=s,l.ok.call(l.as,n,t||d))}}}return(((d.at=f).any||(f.any={}))[c=String.random(7)]=d).off=function(){d.stun=1,f.any&&delete f.any[c]},d.rid=r,d.id=l.run||++h.once,o=h.pass,(h.pass={})[c]=1,l.out=l.out||{get:{}},f.on("out",l.out),h.pass=o,i}if("number"==typeof t)return this.get(""+t,n,e);if("string"==typeof(o=a(t)))return this.get(o,n,e);(o=this.get.next)&&(i=o(this,t))}return i?n&&"function"==typeof n&&i.get(n,e):((i=this.chain())._.err={err:g.log("Invalid get request!",t)},n&&n.call(i,i._.err)),i};var v,s={},a=g.valid})(x,"./get"),x(function(t){var y=x("./root");function m(n,t){var e,o,i;t&&(t=(t._||"").id||t,e=n.root.stun||(n.root.stun={on:y.on}),o={},n.stun||(n.stun=e.on("stun",function(){})),(i=e.on(""+t))&&i.the.last.next(o),o.run>=n.run||e.on(""+t,function(t){return n.stun.end?(this.off(),void this.to.next(t)):(t.run=t.run||n.run,void(t.stun=t.stun||n.stun))}))}function k(n){var e,t,o,i,r;n.err?k.end(n.stun,n.root):n.todo.length||n.end||!Object.empty(n.wait)||(n.end=1,r=n.$.back(-1)._,e=r.root,t=r.ask(function(t){e.on("ack",t),t.err&&!t.lack&&y.log(t),++o>(n.acks||0)&&this.off(),n.ack&&n.ack(t,this)},n.opt),o=0,i=n.stun,(r=function(){i&&(k.end(i,e),setTimeout.each(Object.keys(i=i.add||""),function(t){(t=i[t])&&t()}))}).hatch=r,n.ack&&!n.ok&&(n.ok=n.acks||9),n.via._.on("out",{put:n.out=n.graph,ok:n.ok&&{"@":n.ok+1},opt:n.opt,"#":t,_:r}))}y.chain.put=function(t,n,g){var e=this,o=e._,i=o.root;(g=g||{}).root=o.root,g.run||(g.run=i.once),m(g,o.id),g.ack=g.ack||n,g.via=g.via||e,g.data=g.data||t,g.soul||(g.soul=o.soul||"string"==typeof n&&n);var v=g.state=g.state||y.state();return"function"==typeof t?t(function(t){g.data=t,e.put(void 0,void 0,g)}):g.soul?(g.$=i.$.get(g.soul),g.todo=[{it:g.data,ref:g.$}],g.turn=g.turn||r,g.ran=g.ran||k,function t(){var n,e,i,r,s,o,a,u=g.todo,c=u.pop(),f=c.it;c.ref&&c.ref._.id;if(m(g,c.ref),(r=c.todo)&&(f=f[e=r.pop()],r.length&&u.push(c)),e&&(u.path||(u.path=[])).push(e),!(n=b(f))&&!(s=y.is(f))){if(!Object.plain(f))return void k.err(g,"Invalid data: "+((o=f)&&(a=o.constructor)&&a.name||typeof o)+" at "+(g.via.back(function(t){t.get&&r.push(t.get)},r=[])||r.join("."))+"."+(u.path||[]).join("."));for(var l=g.seen||(g.seen=[]),h=l.length;h--;)if(f===(r=l[h]).it){n=f=r.link;break}}if(e&&n)c.node=w(c.node,e,v,f);else{if(!g.seen)return void k.err(g,"Data at root of graph must be a node (an object).");g.seen.push(i={it:f,link:{},todo:s?[]:Object.keys(f).sort().reverse(),path:(u.path||[]).slice(),up:c}),c.node=w(c.node,e,v,i.link),!s&&i.todo.length&&u.push(i);var p=g.seen.length;function d(t,n){var e=i.link["#"];n&&(n.off(),n.rid(t));var o=e||t.soul||(r=(t.$$||t.$)._||"").soul||r.link||((r=r.put||"")._||"")["#"]||r["#"]||((r=t.put||"")&&t.$$?r:r["="]||r[":"]||"")["#"];e||m(g,t.$),o||c.link["#"]?(o||(o=[],(t.$$||t.$).back(function(t){return(r=t.soul||t.link)?o.push(r):void o.push(t.get)}),o=o.reverse().join("/")),i.link["#"]=o,s||(((g.graph||(g.graph={}))[o]=i.node||(i.node={_:{}}))._["#"]=o),delete g.wait[p],i.wait&&setTimeout.each(i.wait,function(t){t&&t()}),g.ran(g)):(c.wait||(c.wait=[])).push(function(){d(t,n)})}(g.wait||(g.wait={}))[p]="",r=(i.ref=s?f:e?c.ref.get(e):c.ref)._,(r=f&&(f._||"")["#"]||r.soul||r.link)?d({soul:r}):i.ref.get(d,{run:g.run,v2020:1,out:{get:{".":" "}}})}if(!u.length)return g.ran(g);g.turn(t)}()):function(n){var e,t=n.via._;n.via=n.via.back(function(t){return t.soul||!t.get?t.$:(e=n.data,void((n.data={})[t.get]=e))}),n.via&&n.via._.soul||(n.via=t.root.$.get(((n.data||"")._||"")["#"]||t.$.back("opt.uuid")()));n.via.put(n.data,n.ack,n)}(g),e},k.end=function(t,n){t.end=e,t.the.to===t&&t===t.the.last&&delete n.stun,t.off()},k.err=function(t,n){(t.ack||e).call(t,t.out={err:t.err=y.log(n)}),t.ran(t)};var e=function(){},r=setTimeout.turn,b=y.valid,w=y.state.ify})(x,"./put"),x(function(t){var n=x("./root");x("./chain"),x("./back"),x("./put"),x("./get"),t.exports=n})(x,"./core"),x(function(t){var n=x("./root");x("./shim"),x("./onto"),x("./book"),x("./valid"),x("./state"),x("./dup"),x("./ask"),x("./core"),x("./on"),x("./map"),x("./set"),x("./mesh"),x("./websocket"),x("./localStorage"),t.exports=n})(x,"./index"),x(function(t){var g=x("./root");g.chain.on=function(t,n,e,o){var i=this._;i.root;if("string"==typeof t)return n?(o=i.on(t,n,e||i,o),e&&e.$&&(e.subs||(e.subs=[])).push(o),this):i.on(t);(n=!0===n?{change:!0}:n||{}).not=1,n.on=1;return this.get(t,n),this},g.chain.once=function(c,f){if(f=f||{},!c)return t=this,g.log.once("valonce","Chainable val is experimental, its behavior and API may change moving forward. Please play with it and report bugs and ideas on how to improve it."),(e=t.chain())._.nix=t.once(function(t,n){e._.on("in",this._)}),e._.lex=t._.lex,e;var t,e,l,h=this._,p=h.root,d=(h.put,String.random(7));return this.get(function(n,e,o,i){var r=this,s=r._,a=s.one||(s.one={});function u(t){s.has||s.soul||(s={put:n,get:e}),void 0===(l=s.put)&&(l=((o.$$||"")._||"").put),"string"!=typeof g.valid(l)||void 0!==(l=p.$.get(l)._.put)||t?i.stun||""!==a[d]&&(a[d]="",(h.soul||h.has)&&i.off(),c.call(r,l,s.get),clearTimeout(a[d])):a[d]=setTimeout(function(){u(1)},f.wait||99)}i.stun||""!==a[d]&&(!0!==(l=g.valid(n))?"string"!=typeof l&&(clearTimeout((h.one||"")[d]),clearTimeout(a[d]),a[d]=setTimeout(u,f.wait||99)):u())},{on:1}),this},g.chain.off=function(){var e,t=this._,o=t.back;if(o)return t.ack=0,(e=o.next)&&e[t.get]&&delete e[t.get],(e=o.any)&&(delete o.any,o.any={}),(e=o.ask)&&delete e[t.get],(e=o.put)&&delete e[t.get],(e=t.soul)&&delete o.root.graph[e],(e=t.map)&&Object.keys(e).forEach(function(t,n){(n=e[t]).link&&o.root.$.get(n.link).off()}),(e=t.next)&&Object.keys(e).forEach(function(t,n){e[t].$.off()}),t.on("off",{}),this}})(x,"./on"),x(function(t){var a=x("./root"),o=a.chain.get.next;function u(t){this.to.next(t);var n=this.as,e=t.$._,o=t.put;(e.soul||t.$$)&&((e=n.lex)&&!String.match(t.get||(o||"")["."],e["."]||e["#"]||e)||a.on.link(t,n))}a.chain.get.next=function(t,n){var e;return Object.plain(n)?(e=((e=n["#"])||"")["="]||e)?t.get(e):((e=t.chain()._).lex=n,t.on("in",function(t){String.match(t.get||(t.put||"")["."],n["."]||n["#"]||n)&&e.on("in",t),this.to.next(t)}),e.$):(o||c)(t,n)},a.chain.map=function(r,t,n){var e,s,o=this,i=o._;return Object.plain(r)&&(e=r["."]?r:{".":r},r=void 0),r?(a.log.once("mapfn","Map functions are experimental, their behavior and API may change moving forward. Please play with it and report bugs and ideas on how to improve it."),s=o.chain(),o.map().on(function(t,n,e,o){o=(r||c).call(this,t,n,e,o);if(void 0!==o){if(t===o)return s._.on("in",e);if(a.is(o))return s._.on("in",o._);var i={};Object.keys(e.put).forEach(function(t){i[t]=e.put[t]},i),i["="]=o,s._.on("in",{get:n,put:i})}})):(s=i.each)||((i.each=s=o.chain())._.lex=e||s._.lex||i.lex,s._.nix=o.back("nix"),o.on("in",u,s._)),s};var c=function(){}})(x,"./map"),x(function(t){var a=x("./root");a.chain.set=function(t,i,n){var e,r,s=this,o=s.back(-1);return i=i||function(){},(n=n||{}).item=n.item||t,(e=((t||"")._||"")["#"])&&((t={})["#"]=e),"string"==typeof(r=a.valid(t))?s.get(e=r).put(t,i,n):a.is(t)?(s.put(function(o){t.get(function(t,n,e){return t?((r={})[t]={"#":t},void o(r)):i.call(s,{err:a.log('Only a node can be linked! Not "'+e.put+'"!')})},!0)}),t):(Object.plain(t)&&(t=o.get(e=s.back("opt.uuid")()).put(t)),s.get(e||o.back("opt.uuid")(7)).put(t,i,n))}})(x,"./set"),x(function(t){x("./shim");function n(){}var r=JSON.parseAsync||function(t,n,e){var o=+new Date;try{n(void 0,JSON.parse(t,e),_.sucks(+new Date-o))}catch(t){n(t)}},_=JSON.stringifyAsync||function(t,n,e,o){var i=+new Date;try{n(void 0,JSON.stringify(t,e,o),_.sucks(+new Date-i))}catch(t){n(t)}};function e(u){var g=function(){},v=u.opt||{};v.log=v.log||console.log,v.gap=v.gap||v.wait||0,v.max=v.max||.3*(v.memory?999*v.memory*999:3e8),v.pack=v.pack||.01*v.max*.01,v.puff=v.puff||9;var y=setTimeout.turn||setTimeout,m=u.dup,h=m.check,k=m.track,i=(new Date,g.hear=function(t,s){if(t){if(v.max<=t.length)return g.say({dam:"!",err:"Message too big!"},s);g===this&&(i.d+=t.length||0,++i.c);var n,e=s.SH=+new Date,o=t[0];if("["===o)return r(t,function(t,i){if(t||!i)return g.say({dam:"!",err:"DAM JSON parse error."},s);console.STAT&&console.STAT(+new Date,i.length,"# on hear batch");var r=v.puff;!function t(){for(var n,e=+new Date,o=0;o<r&&(n=i[o++]);)g.hear(n,s);i=i.slice(o),console.STAT&&console.STAT(e,+new Date-e,"hear loop"),b(s),i.length&&y(t,0)}()}),void(t="");if("{"===o||(t["#"]||Object.plain(t))&&(n=t)){if(n)return i.one(n,s,e);r(t,function(t,n){return t||!n?g.say({dam:"!",err:"DAM JSON parse error."},s):void i.one(n,s,e)})}}});i.one=function(n,e,t){var o,i,r,s,a;if(n.DBG&&(n.DBG=a={DBG:n.DBG}),a&&(a.h=t),a&&(a.hp=+new Date),(o=n["#"])||(o=n["#"]=String.random(9)),!((r=h(o))||(i=n["##"])&&(r=n["@"]||n.get&&o)&&m.check(s=r+i))){if((n._=function(){}).via=g.leap=e,(r=n["><"])&&"string"==typeof r&&r.slice(0,99).split(",").forEach(function(t){this[t]=1},n._.yo={}),r=n.dam)return(k(o)||{}).via=e,void((r=g.hear[r])&&r(n,e,u));(r=n.ok)&&(n._.near=r["/"]);t=+new Date;a&&(a.is=t),e.SI=o,k.ed=function(t){o===t&&(k.ed=0,(t=m.s[o])&&(t.via=e,n.get&&(t.it=n)))},u.on("in",g.last=n),a&&(a.hd=+new Date),console.STAT&&console.STAT(t,+new Date-t,n.get?"msg get":n.put?"msg put":"msg"),k(o),s&&k(s),g.leap=g.last=null}};function b(t){var n=t.batch,e="string"==typeof n;if(e&&(n+="]"),t.batch=t.tail=null,n&&(e?!(n.length<3):n.length)){if(!e)try{n=1===n.length?n[0]:JSON.stringify(n)}catch(t){return v.log("DAM JSON stringify error",t)}n&&w(n,t)}}function w(n,e){try{var t=e.wire;e.say?e.say(n):t.send&&t.send(n),g.say.d+=n.length||0,++g.say.c}catch(t){(e.queue=e.queue||[]).push(n)}}i.c=i.d=0,function(){var p,d=0;function t(t,n){var e;return n instanceof Object?(Object.keys(n).sort().forEach(o,{to:e={},on:n}),e):n}function o(t){this.to[t]=this.on[t]}g.hash=function(o,i){var r,s,a,u=+new Date;_(o.put,function t(n,e){e=(s=s||(a=e||"")).slice(0,32768);r=String.hash(e,r),(s=s.slice(32768))?y(t,0):(console.STAT&&console.STAT(u,+new Date-u,"say json+hash"),o._.$put=a,o["##"]=r,g.say(o,i),delete o._.$put)},t)};g.say=function(r,s){var t;if((t=this)&&(t=t.to)&&t.next&&t.next(r),!r)return!1;var n,e,a,u=r["@"],c=r._||(r._=function(){}),o=r.DBG,i=+new Date;if(c.y=c.y||i,s||o&&(o.y=i),(n=r["#"])||(n=r["#"]=String.random(9)),p||k(n),(e=r["##"])||$===r.put||c.via||!u){if(!(s=!s&&u?(t=m.s[u])&&(t.via||(t=t.it)&&(t=t._)&&t.via)||(t=g.last)&&u===t["#"]&&g.leap:s)&&u)return m.s[u]?void 0:(console.STAT&&console.STAT(+new Date,++d,"total no peer to ack to"),!1);if(u&&!r.put&&!e&&((m.s[u]||"").it||"")["##"])return!1;if(!s&&g.way)return g.way(r);if(o&&(o.yh=+new Date),a=c.raw){if(o&&(o.yr=+new Date),!s||!s.id){if(!Object.plain(s||v.peers))return!1;var i=+new Date,f=(v.puff,v.peers),l=Object.keys(s||v.peers||{});return console.STAT&&console.STAT(i,+new Date-i,"peer keys"),void function t(){var n=+new Date;p=1;var e=c.raw;c.raw=a;for(var o,i=0;i<9&&(o=(l||"")[i++]);)(o=f[o]||(s||"")[o])&&g.say(r,o);c.raw=e,p=0,l=l.slice(i),console.STAT&&console.STAT(n,+new Date-n,"say loop"),l.length&&(y(t,0),u&&k(u))}()}if(!s.wire&&g.wire&&g.wire(s),n!==s.last){if(s.last=n,s===c.via)return!1;if((t=c.yo)&&(t[s.url]||t[s.pid]||t[s.id]))return!1;if(console.STAT&&console.STAT(i,((o||c).yp=+new Date)-(c.y||i),"say prep"),!p&&u&&k(u),s.batch){if(s.tail=(t=s.tail||0)+a.length,s.tail<=v.pack)return void(s.batch+=(t?",":"")+a);b(s)}s.batch="[";var h=+new Date;setTimeout(function(){console.STAT&&console.STAT(h,+new Date-h,"0ms TO"),b(s)},v.gap),w(a,s),console.STAT&&u===s.SI&&console.STAT(i,+new Date-s.SH,"say ack")}}else g.raw(r,s)}else g.hash(r,s)};g.say.c=g.say.d=0,g.raw=function(e,o){if(!e)return"";var i,r=e._||{};if(a=r.raw)return a;if("string"==typeof e)return e;var t=e["##"],n=e["@"];if(t&&n){if(!r.via&&h(n+t))return!1;if(a=(m.s[n]||"").it){if(t===a["##"])return!1;a["##"]||(a["##"]=t)}}if(!e.dam&&!e["@"]){var s,a,u=0,c=[];for(s in a=v.peers){var f=a[s];if(c.push(f.url||f.pid||f.id),6<++u)break}1<u&&(e["><"]=c.join())}if(e.put&&(a=e.ok)&&(e.ok={"@":(a["@"]||1)-1,"/":a["/"]==e._.near?g.near:a["/"]}),i=r.$put)return a={},Object.keys(e).forEach(function(t){a[t]=e[t]}),a.put=":])([:",void _(a,function(t,n){t||(t=+new Date,a=n.indexOf('"put":":])([:"'),l($,n=n.slice(0,a+6)+i+n.slice(a+14)),console.STAT&&console.STAT(t,+new Date-t,"say slice"))});function l(t,n){t||(r.raw=n,g.say(e,o))}_(e,l)}}(),g.near=0,g.hi=function(n){var t;n.wire?(n.id?v.peers[n.url||n.id]=n:(t=n.id=n.id||n.url||String.random(9),g.say({dam:"?",pid:u.opt.pid},v.peers[t]=n),delete m.s[n.last]),n.met||(g.near++,n.met=+new Date,u.on("hi",n)),t=n.queue,n.queue=[],setTimeout.each(t||[],function(t){w(t,n)},0,9)):g.wire(n.length?{url:n,id:n}:n)},g.bye=function(t){t.met&&--g.near,delete t.met,u.on("bye",t);var n=+new Date;n-=t.met||n,g.bye.time=((g.bye.time||n)+n)/2},g.hear["!"]=function(t,n){v.log("Error:",t.err)},g.hear["?"]=function(t,n){t.pid&&(n.pid||(n.pid=t.pid),t["@"])||(g.say({dam:"?",pid:v.pid,"@":t["#"]},n),delete m.s[n.last])},g.hear.mob=function(t,n){!t.peers||(t=(t=Object.keys(t.peers))[Math.random()*t.length>>0])&&(g.bye(n),g.hi(t))},u.on("create",function(t){t.opt.pid=t.opt.pid||String.random(9),this.to.next(t),t.on("out",g.say)}),u.on("bye",function(t,n){t=v.peers[t.id||t]||t,this.to.next(t),t.bye?t.bye():(n=t.wire)&&n.close&&n.close(),delete v.peers[t.id],t.wire=null});var e={};return u.on("bye",function(t,n){this.to.next(t),(n=console.STAT)&&(n.peers=g.near),(n=t.url)&&(e[n]=!0,setTimeout(function(){delete e[n]},v.lack||9e3))}),u.on("hi",function(e,t){this.to.next(e),(t=console.STAT)&&(t.peers=g.near),v.super||(9999<(t=Object.keys(u.next||"")).length&&!console.SUBS&&console.log(console.SUBS="Warning: You have more than 10K live GETs, which might use more bandwidth than your screen can show - consider `.off()`."),setTimeout.each(t,function(n){var t=u.next[n];v.super||(t.ask||"")[""]?g.say({get:{"#":n}},e):setTimeout.each(Object.keys(t.ask||""),function(t){t&&g.say({"##":String.hash((u.graph[n]||"")[t]),get:{"#":n,".":t}},e)})}))}),g}_.sucks=function(t){99<t&&(console.log("Warning: JSON blocking CPU detected. Add `gun/lib/yson.js` to fix."),_.sucks=n)};var $;try{t.exports=e}catch(t){}})(x,"./mesh"),x(function(t){var u=x("./root");u.Mesh=x("./mesh"),u.on("opt",function(t){var o,n,i,e,r;function s(n){try{if(!n||!n.url)return i&&i(n);var t=n.url.replace(/^http/,"ws"),e=n.wire=new o.WebSocket(t);return e.onclose=function(){a(n),o.mesh.bye(n)},e.onerror=function(t){a(n)},e.onopen=function(){o.mesh.hi(n)},e.onmessage=function(t){t&&o.mesh.hear(t.data||t,n)},e}catch(t){o.mesh.bye(n)}}function a(n){clearTimeout(n.defer),o.peers[n.url]&&(r&&n.retry<=0||(n.retry=(n.retry||o.retry+1||60)-(-n.tried+(n.tried=+new Date)<4*e?1:0),n.defer=setTimeout(function t(){return r&&r.hidden?setTimeout(t,e):void s(n)},e)))}this.to.next(t),t.once||!1!==(o=t.opt).WebSocket&&(n=u.window||{},(n=o.WebSocket||n.WebSocket||n.webkitWebSocket||n.mozWebSocket)&&(o.WebSocket=n,n=o.mesh=o.mesh||u.Mesh(t),i=n.wire||o.wire,n.wire=o.wire=s,setTimeout(function(){o.super||t.on("out",{dam:"hi"})},1),e=1998,r=""+void 0!=typeof document&&document))})})(x,"./websocket"),x(function(t){if("undefined"!=typeof Gun){var i;try{i=(Gun.window||function(){}).localStorage}catch(t){}i||(Gun.log("Warning: No localStorage exists to persist data to!"),i={setItem:function(t,n){this[t]=n},removeItem:function(t){delete this[t]},getItem:function(t){return this[t]}});JSON.parseAsync;var r=JSON.stringifyAsync||function(t,n,e,o){try{n(void 0,JSON.stringify(t,e,o))}catch(t){n(t)}};Gun.on("create",function n(s){this.to.next(s);var a,u,c,f,o=s.opt,l=(s.graph,[]);if(!1!==o.localStorage){o.prefix=o.file||"gun/";try{a=n[o.prefix]=n[o.prefix]||JSON.parse(c=i.getItem(o.prefix))||{}}catch(t){a=n[o.prefix]={}}c=(c||"").length,s.on("get",function(t){this.to.next(t);var n,e,o,i=t.get;i&&(n=i["#"])&&((e=a[n]||void 0)&&(o=i["."])&&!Object.plain(o)&&(e=Gun.state.ify({},o,Gun.state.is(e,o),e[o],n)),Gun.on.get.ack(t,e))}),s.on("put",function(t){this.to.next(t);var n=t.put,e=n["#"],o=n["."],i=t["#"],r=t.ok||"";a[e]=Gun.state.ify(a[e],o,n[">"],n[":"],e),f&&4999880<c?s.on("in",{"@":i,err:"localStorage max!"}):(t["@"]||t._.via&&!(Math.random()<r["@"]/r["/"])||l.push(i),u=u||setTimeout(h,9+c/333))})}function h(){var e;l.length||!((setTimeout.turn||"").s||"").length?(e=l,clearTimeout(u),u=!1,l=[],r(a,function(n,t){try{n||i.setItem(o.prefix,t)}catch(t){n=f=t||"localStorage failure"}n&&(Gun.log(n+" Consider using GUN's IndexedDB plugin for RAD for more storage space, https://gun.eco/docs/RAD#install"),s.on("localStorage:error",{err:n,get:o.prefix,put:a})),c=t.length,setTimeout.each(e,function(t){s.on("in",{"@":t,err:n,ok:0})},0,99)})):setTimeout(h,99)}})}})(x,"./localStorage")}(),function(){var l,h,n,p,d,a,e,o,i,u,r,s,c,f,g,v,y,t,m,k,b,w,_,$,x,j;function T(t,n){b(this,n)&&void 0!==this[n]||(this[n]=t)}function S(t,n){var e=this.n;if(!e||!(n===e||m(e)&&b(e,n)))return void 0!==n||void 0}function O(t,n){if(2===arguments.length)return O.r=O.r||{},void(O.r[t]=n);O.r=O.r||[],O.r.push(t)}function D(t,n){return!this.id&&n==e&&i(t)?void(this.id=t):this.id=!1}function A(t,n){if(n!==u._)return!a.is(t)||void(this.cb&&this.cb.call(this.as,t,n,this.n,this.s))}function G(t,n){var e,o=this.o;o.map?void 0===(e=o.map.call(this.as,t,""+n,o.node))?k(o.node,n):o.node&&(o.node[n]=e):a.is(t)&&(o.node[n]=t)}function N(t,n){g!==n&&c.ify(this.o,n,this.s)}function B(t,n){if(!t||n!==u.soul(t)||!u.is(t,this.fn,this.as))return!0;this.cb&&(J.n=t,J.as=this.as,this.cb.call(J.as,t,n,J))}function J(t){t&&u.is(J.n,t,J.as)}function I(t,n){var e;return(e=function(t,n){var e,o=t.seen,i=o.length;for(;i--;)if(e=o[i],n.obj===e.obj)return e;o.push(n)}(t,n))?e:(n.env=t,n.soul=E,u.ify(n.obj,M,n)&&(n.link=n.link||a.link.ify(u.soul(n.node)),n.obj!==t.shell&&(t.graph[a.link.is(n.link)]=n.node)),n)}function M(t,n,e){var o,i,r=this,s=r.env;if(u._===n&&b(t,a.link._))return e._;if(o=W(t,n,e,r,s)){if(n||(r.node=r.node||e||{},b(t,u._)&&u.soul(t)&&(r.node._=x(t._)),r.node=u.soul.ify(r.node,a.link.is(r.link)),r.link=r.link||a.link.ify(u.soul(r.node))),(i=s.map)&&(i.call(s.as||{},t,n,e,r),b(e,n))){if(t=e[n],j===t)return void k(e,n);if(!(o=W(t,n,e,r,s)))return}return n?!0===o?t:(i=I(s,{obj:t,path:r.path.concat(n)})).node?i.link:void 0:r.node}}function E(t){var n=this,e=a.link.is(n.link),o=n.env.graph;n.link=n.link||a.link.ify(t),n.link[a.link._]=t,n.node&&n.node[u._]&&(n.node[u._][a.link._]=t),b(o,e)&&(o[t]=o[e],k(o,e))}function W(t,n,e,o,i){var r;return!!a.is(t)||(m(t)?1:(r=i.invalid)?W(t=r.call(i.as||{},t,n,e),n,e,o,i):(i.err="Invalid value at '"+o.path.concat(n).join(".")+"'!",void(h.list.is(t)&&(i.err+=" Use `.set(item)` instead of an Array."))))}function C(t,n){var e,o;if(u._===n)return w(t,a.link._)?void 0:void(this.obj[n]=x(t));(e=a.link.is(t))?(o=this.opt.seen[e])?this.obj[n]=o:this.obj[n]=this.opt.seen[e]=v.to(this.graph,e,this.opt):this.obj[n]=t}""+j!=typeof Gun&&(l=function(t){console.warn("Warning! Deprecated internal utility will break in next version:",t)},(h=Gun).fn=h.fn||{is:function(t){return l("fn"),!!t&&"function"==typeof t}},h.bi=h.bi||{is:function(t){return l("bi"),t instanceof Boolean||"boolean"==typeof t}},h.num=h.num||{is:function(t){return l("num"),!d(t)&&(0<=t-parseFloat(t)+1||1/0===t||-1/0===t)}},h.text=h.text||{is:function(t){return l("text"),"string"==typeof t}},h.text.ify=h.text.ify||function(t){return l("text.ify"),h.text.is(t)?t:"undefined"!=typeof JSON?JSON.stringify(t):t&&t.toString?t.toString():t},h.text.random=h.text.random||function(t,n){l("text.random");var e="";for(t=t||24,n=n||"0123456789ABCDEFGHIJKLMNOPQRSTUVWXZabcdefghijklmnopqrstuvwxyz";0<t;)e+=n.charAt(Math.floor(Math.random()*n.length)),t--;return e},h.text.match=h.text.match||function(t,n){var e,o;return l("text.match"),"string"==typeof t&&(t===((n=(n="string"==typeof n?{"=":n}:n)||{})["="]||n["*"]||n[">"]||n["<"])||o===n["="]&&(e=n["*"]||n[">"]||n["<"],t.slice(0,(e||"").length)===e||o===n["*"]&&(o!==n[">"]&&o!==n["<"]?t>=n[">"]&&t<=n["<"]:o!==n[">"]&&t>=n[">"]||o!==n["<"]&&t<=n["<"])))},h.text.hash=h.text.hash||function(t,n){if(l("text.hash"),"string"==typeof t){if(n=n||0,!t.length)return n;for(var e=0,o=t.length;e<o;++e)n=(n<<5)-n+t.charCodeAt(e),n|=0;return n}},h.list=h.list||{is:function(t){return l("list"),t instanceof Array}},h.list.slit=h.list.slit||Array.prototype.slice,h.list.sort=h.list.sort||function(e){return l("list.sort"),function(t,n){return t&&n?(t=t[e])<(n=n[e])?-1:n<t?1:0:0}},h.list.map=h.list.map||function(t,n,e){return l("list.map"),$(t,n,e)},h.list.index=1,h.obj=h.boj||{is:function(t){return l("obj"),!!t&&(t instanceof Object&&t.constructor===Object||"Object"===Object.prototype.toString.call(t).match(/^\[object (\w+)\]$/)[1])}},h.obj.put=h.obj.put||function(t,n,e){return l("obj.put"),(t||{})[n]=e,t},h.obj.has=h.obj.has||function(t,n){return l("obj.has"),t&&Object.prototype.hasOwnProperty.call(t,n)},h.obj.del=h.obj.del||function(t,n){if(l("obj.del"),t)return t[n]=null,delete t[n],t},h.obj.as=h.obj.as||function(t,n,e,o){return l("obj.as"),t[n]=t[n]||(o===e?{}:e)},h.obj.ify=h.obj.ify||function(n){if(l("obj.ify"),m(n))return n;try{n=JSON.parse(n)}catch(t){n={}}return n},h.obj.to=h.obj.to||function(t,n){return l("obj.to"),$(t,T,n=n||{}),n},h.obj.copy=h.obj.copy||function(t){return l("obj.copy"),t&&JSON.parse(JSON.stringify(t))},h.obj.empty=h.obj.empty||function(t,n){return l("obj.empty"),!t||!$(t,S,{n:n})},p=Object.keys,Object.keys=Object.keys||function(t){return n(t,function(t,n,e){e(n)})},h.obj.map=n=h.obj.map||function(t,n,e){l("obj.map");var o,i,r,s,a,u=0,c="function"==typeof n;if(O.r=o,p&&m(t)&&(s=p(t),a=!0),e=e||{},d(t)||s)for(i=(s||t).length;u<i;u++){var f=u+h.list.index;if(c){if((r=a?n.call(e,t[s[u]],s[u],O):n.call(e,t[u],f,O))!==o)return r}else if(n===t[a?s[u]:u])return s?s[u]:f}else for(u in t)if(c){if(b(t,u)&&(r=e?n.call(e,t[u],u,O):n(t[u],u,O))!==o)return r}else if(n===t[u])return u;return c?O.r:h.list.index?0:-1},h.time=h.time||{},h.time.is=h.time.is||function(t){return l("time"),t?t instanceof Date:+(new Date).getTime()},y=h.fn.is,d=h.list.is,t=h.obj,m=t.is,b=t.has,$=t.map,(a={is:function(t){return l("val.is"),t!==j&&(null===t||t!==1/0&&(!!(i(t)||o(t)||f(t))||(a.link.is(t)||!1)))}}).link=a.rel={_:"#"},a.link.is=function(t){if(l("val.link.is"),t&&t[e]&&!t._&&m(t)){var n={};if($(t,D,n),n.id)return n.id}return!1},a.link.ify=function(t){return l("val.link.ify"),_({},e,t)},h.obj.has._=".",e=a.link._,o=h.bi.is,f=h.num.is,i=h.text.is,m=(t=h.obj).is,_=t.put,$=t.map,h.val=h.val||a,(u={_:"_",soul:function(t,n){return l("node.soul"),t&&t._&&t._[n||s]}}).soul.ify=function(t,n){return l("node.soul.ify"),n="string"==typeof n?{soul:n}:n||{},(t=t||{})._=t._||{},t._[s]=n.soul||t._[s]||r(),t},u.soul._=a.link._,u.is=function(t,n,e){var o;return l("node.is"),!!m(t)&&(!!(o=u.soul(t))&&!$(t,A,{as:e,cb:n,s:o,n:t}))},u.ify=function(t,n,e){return l("node.ify"),n?"string"==typeof n?n={soul:n}:"function"==typeof n&&(n={map:n}):n={},n.map&&(n.node=n.map.call(e,t,j,n.node||{})),(n.node=u.soul.ify(n.node||{},n))&&$(t,G,{o:n,as:e}),n.node},m=(t=h.obj).is,k=t.del,$=t.map,r=h.text.random,s=u.soul._,h.node=h.node||u,(c=h.state).lex=function(){return l("state.lex"),c().toString(36).replace(".","")},c.to=function(t,n,e){l("state.to");var o=(t||{})[n];return m(o)&&(o=x(o)),c.ify(e,n,c.is(t,n),o,u.soul(t))},c.map=function(i,r,s){l("state.map");var t=m(t=i||r)?t:null;return i=y(i=i||r)?i:null,t&&!i?(r=f(r)?r:c(),t[g]=t[g]||{},$(t,N,{o:t,s:r}),t):(s=s||m(r)?r:void 0,r=f(r)?r:c(),function(t,n,e,o){if(!i)return N.call({o:e,s:r},t,n),t;i.call(s||this||{},t,n,e,o),b(e,n)&&void 0===e[n]||N.call({o:e,s:r},t,n)})},(t=h.obj).as,b=t.has,m=t.is,$=t.map,x=t.copy,f=h.num.is,y=h.fn.is,g=u._,v={is:function(t,n,e,o){return l("graph.is"),!(!t||!m(t)||w(t))&&!$(t,B,{cb:n,fn:e,as:o})},ify:function(t,n,e){l("graph.ify");t={path:[],obj:t};return n?"string"==typeof n?n={soul:n}:"function"==typeof n&&(n.map=n):n={},"string"==typeof e&&(n.soul=n.soul||e,e=j),n.soul&&(t.link=a.link.ify(n.soul)),n.shell=(e||{}).shell,n.graph=n.graph||{},n.seen=n.seen||[],n.as=n.as||e,I(n,t),n.root=t.node,n.graph},node:function(t){l("graph.node");var n=u.soul(t);if(n)return _({},n,t)},to:function(t,n,e){if(l("graph.to"),t){var o={};return $(t[n],C,{obj:o,graph:t,opt:e=e||{seen:{}}}),o}}},y=h.fn.is,m=(t=h.obj).is,k=t.del,b=t.has,w=t.empty,_=t.put,$=t.map,x=t.copy,h.graph=h.graph||v)}();